<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Data Analysis - 4&nbsp; Spatial Regression Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07_impacts_short.html" rel="next">
<link href="./04_exercise1_short.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="site_libs/quarto-diagram/mermaid.min.js"></script><script src="site_libs/quarto-diagram/mermaid-init.js"></script><link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="site_libs/jquery-1.12.4/jquery.min.js"></script><link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script><link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script><script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="site_libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><link href="site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="site_libs/HomeButton-0.0.1/home-button.js"></script><script src="site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="site_libs/clipboard-0.0.1/setClipboardText.js"></script><link href="site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_regression-theory_short.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spatial Regression Models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ruettenauer/Geodata_Spatial_Regression_short/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_refresher_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Refresher</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_weights_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spatial Relationships</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_exercise1_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exercise I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_regression-theory_short.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spatial Regression Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_impacts_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Impacts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_exercise2_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exercise II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#required-packages" id="toc-required-packages" class="nav-link active" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#reload-data-from-pervious-session" id="toc-reload-data-from-pervious-session" class="nav-link" data-scroll-target="#reload-data-from-pervious-session">Reload data from pervious session</a></li>
  <li>
<a href="#why-do-we-need-spatial-regression-models" id="toc-why-do-we-need-spatial-regression-models" class="nav-link" data-scroll-target="#why-do-we-need-spatial-regression-models"><span class="header-section-number">4.1</span> Why do we need spatial regression models</a>
  <ul class="collapse">
<li><a href="#non-spatial-ols" id="toc-non-spatial-ols" class="nav-link" data-scroll-target="#non-spatial-ols"><span class="header-section-number">4.1.1</span> Non-spatial OLS</a></li>
  <li><a href="#problem-of-ignoring-spatial-dependence" id="toc-problem-of-ignoring-spatial-dependence" class="nav-link" data-scroll-target="#problem-of-ignoring-spatial-dependence"><span class="header-section-number">4.1.2</span> Problem of ignoring spatial dependence</a></li>
  </ul>
</li>
  <li>
<a href="#spatial-regression-models" id="toc-spatial-regression-models" class="nav-link" data-scroll-target="#spatial-regression-models"><span class="header-section-number">4.2</span> Spatial Regression Models</a>
  <ul class="collapse">
<li><a href="#spatial-error-model-sem" id="toc-spatial-error-model-sem" class="nav-link" data-scroll-target="#spatial-error-model-sem"><span class="header-section-number">4.2.1</span> Spatial Error Model (SEM)</a></li>
  <li><a href="#spatial-autoregressive-model-sar" id="toc-spatial-autoregressive-model-sar" class="nav-link" data-scroll-target="#spatial-autoregressive-model-sar"><span class="header-section-number">4.2.2</span> Spatial Autoregressive Model (SAR)</a></li>
  <li><a href="#spatially-lagged-x-model-slx" id="toc-spatially-lagged-x-model-slx" class="nav-link" data-scroll-target="#spatially-lagged-x-model-slx"><span class="header-section-number">4.2.3</span> Spatially lagged X Model (SLX)</a></li>
  <li><a href="#spatial-durbin-model-sdm" id="toc-spatial-durbin-model-sdm" class="nav-link" data-scroll-target="#spatial-durbin-model-sdm"><span class="header-section-number">4.2.4</span> Spatial Durbin Model (SDM)</a></li>
  <li><a href="#spatial-durbin-error-model-sdem" id="toc-spatial-durbin-error-model-sdem" class="nav-link" data-scroll-target="#spatial-durbin-error-model-sdem"><span class="header-section-number">4.2.5</span> Spatial Durbin Error Model (SDEM)</a></li>
  <li><a href="#combined-spatial-autocorrelation-model-sac" id="toc-combined-spatial-autocorrelation-model-sac" class="nav-link" data-scroll-target="#combined-spatial-autocorrelation-model-sac"><span class="header-section-number">4.2.6</span> Combined Spatial Autocorrelation Model (SAC)</a></li>
  <li><a href="#general-nesting-spatial-model-gns" id="toc-general-nesting-spatial-model-gns" class="nav-link" data-scroll-target="#general-nesting-spatial-model-gns"><span class="header-section-number">4.2.7</span> General Nesting Spatial Model (GNS)</a></li>
  <li><a href="#a-note-on-missings" id="toc-a-note-on-missings" class="nav-link" data-scroll-target="#a-note-on-missings"><span class="header-section-number">4.2.8</span> A note on missings</a></li>
  </ul>
</li>
  <li><a href="#mini-example" id="toc-mini-example" class="nav-link" data-scroll-target="#mini-example"><span class="header-section-number">4.3</span> Mini Example</a></li>
  <li>
<a href="#real-example" id="toc-real-example" class="nav-link" data-scroll-target="#real-example"><span class="header-section-number">4.4</span> Real Example</a>
  <ul class="collapse">
<li><a href="#sar" id="toc-sar" class="nav-link" data-scroll-target="#sar"><span class="header-section-number">4.4.1</span> SAR</a></li>
  <li><a href="#sem" id="toc-sem" class="nav-link" data-scroll-target="#sem"><span class="header-section-number">4.4.2</span> SEM</a></li>
  <li><a href="#slx" id="toc-slx" class="nav-link" data-scroll-target="#slx"><span class="header-section-number">4.4.3</span> SLX</a></li>
  <li><a href="#sdem" id="toc-sdem" class="nav-link" data-scroll-target="#sdem"><span class="header-section-number">4.4.4</span> SDEM</a></li>
  <li><a href="#sdm" id="toc-sdm" class="nav-link" data-scroll-target="#sdm"><span class="header-section-number">4.4.5</span> SDM</a></li>
  </ul>
</li>
  <li>
<a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">4.5</span> Estimation</a>
  <ul class="collapse">
<li><a href="#simulataneity-bias" id="toc-simulataneity-bias" class="nav-link" data-scroll-target="#simulataneity-bias"><span class="header-section-number">4.5.1</span> Simulataneity bias</a></li>
  <li><a href="#instrumental-variable" id="toc-instrumental-variable" class="nav-link" data-scroll-target="#instrumental-variable"><span class="header-section-number">4.5.2</span> Instrumental variable</a></li>
  </ul>
</li>
  <li><a href="#maximum-likelihood" id="toc-maximum-likelihood" class="nav-link" data-scroll-target="#maximum-likelihood"><span class="header-section-number">4.6</span> Maximum Likelihood</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spatial Regression Models</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="required-packages" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="required-packages">Required packages</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sf"</span>, <span class="st">"mapview"</span>, <span class="st">"spdep"</span>, <span class="st">"spatialreg"</span>, <span class="st">"tmap"</span>, <span class="st">"viridisLite"</span><span class="op">)</span> <span class="co"># note: load spdep first, then spatialreg</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">pkgs</span>, <span class="va">require</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="session-info" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="session-info">Session info</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19044)

Matrix products: default


locale:
[1] LC_COLLATE=English_United Kingdom.utf8 
[2] LC_CTYPE=English_United Kingdom.utf8   
[3] LC_MONETARY=English_United Kingdom.utf8
[4] LC_NUMERIC=C                           
[5] LC_TIME=English_United Kingdom.utf8    

time zone: Europe/Berlin
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods  
[7] base     

other attached packages:
[1] viridisLite_0.4.2 tmap_3.3-3        spatialreg_1.2-9 
[4] Matrix_1.5-4.1    spdep_1.2-8       spData_2.3.0     
[7] mapview_2.11.0    sf_1.0-13        

loaded via a namespace (and not attached):
 [1] xfun_0.39          raster_3.6-23      htmlwidgets_1.6.2 
 [4] lattice_0.21-8     vctrs_0.6.3        tools_4.3.1       
 [7] crosstalk_1.2.0    LearnBayes_2.15.1  generics_0.1.3    
[10] parallel_4.3.1     sandwich_3.0-2     stats4_4.3.1      
[13] tibble_3.2.1       proxy_0.4-27       fansi_1.0.4       
[16] pkgconfig_2.0.3    KernSmooth_2.23-21 satellite_1.0.4   
[19] RColorBrewer_1.1-3 leaflet_2.1.2      webshot_0.5.5     
[22] lifecycle_1.0.3    compiler_4.3.1     deldir_1.0-9      
[25] munsell_0.5.0      terra_1.7-39       leafsync_0.1.0    
[28] codetools_0.2-19   stars_0.6-1        htmltools_0.5.5   
[31] class_7.3-22       pillar_1.9.0       MASS_7.3-60       
[34] classInt_0.4-9     lwgeom_0.2-13      wk_0.7.3          
[37] abind_1.4-5        boot_1.3-28.1      multcomp_1.4-25   
[40] nlme_3.1-162       tidyselect_1.2.0   digest_0.6.32     
[43] mvtnorm_1.2-2      dplyr_1.1.2        splines_4.3.1     
[46] fastmap_1.1.1      grid_4.3.1         colorspace_2.1-0  
[49] expm_0.999-7       cli_3.6.1          magrittr_2.0.3    
[52] base64enc_0.1-3    dichromat_2.0-0.1  XML_3.99-0.14     
[55] survival_3.5-5     utf8_1.2.3         TH.data_1.1-2     
[58] leafem_0.2.0       e1071_1.7-13       scales_1.2.1      
[61] sp_1.6-1           rmarkdown_2.23     zoo_1.8-12        
[64] png_0.1-8          coda_0.19-4        evaluate_0.21     
[67] knitr_1.43         tmaptools_3.1-1    s2_1.1.4          
[70] rlang_1.1.1        Rcpp_1.0.10        glue_1.6.2        
[73] DBI_1.1.3          rstudioapi_0.14    jsonlite_1.8.5    
[76] R6_2.5.1           units_0.8-2       </code></pre>
</div>
</div>
</section><section id="reload-data-from-pervious-session" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="reload-data-from-pervious-session">Reload data from pervious session</h3>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"_data/msoa2_spatial.RData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are various techniques to model spatial dependence and spatial processes <span class="citation" data-cites="LeSage.2009">(<a href="references.html#ref-LeSage.2009" role="doc-biblioref">LeSage and Pace 2009</a>)</span>. Here, we will just cover a few of the most common techniques / econometric models. One advantage of the most basic spatial model (SLX) is that this method can easily be incorporated in a variety of other methodologies, such as machine learning approaches.</p>
<p>For more in-depth materials see <span class="citation" data-cites="LeSage.2009">LeSage and Pace (<a href="references.html#ref-LeSage.2009" role="doc-biblioref">2009</a>)</span> and <span class="citation" data-cites="Kelejian.2017">Kelejian and Piras (<a href="references.html#ref-Kelejian.2017" role="doc-biblioref">2017</a>)</span>. <span class="citation" data-cites="Franzese.2007">Franzese and Hays (<a href="references.html#ref-Franzese.2007" role="doc-biblioref">2007</a>)</span>, <span class="citation" data-cites="HalleckVega.2015">Halleck Vega and Elhorst (<a href="references.html#ref-HalleckVega.2015" role="doc-biblioref">2015</a>)</span>, <span class="citation" data-cites="LeSage.2014">LeSage (<a href="references.html#ref-LeSage.2014" role="doc-biblioref">2014</a>)</span>, <span class="citation" data-cites="Ruttenauer.2022a">Rüttenauer (<a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">2022</a>)</span>, and <span class="citation" data-cites="Wimpy.2021">Wimpy, Whitten, and Williams (<a href="references.html#ref-Wimpy.2021" role="doc-biblioref">2021</a>)</span> provide article-length introductions.</p>
</section><section id="why-do-we-need-spatial-regression-models" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="why-do-we-need-spatial-regression-models">
<span class="header-section-number">4.1</span> Why do we need spatial regression models</h2>
<section id="non-spatial-ols" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="non-spatial-ols">
<span class="header-section-number">4.1.1</span> Non-spatial OLS</h3>
<p>Let us start with a linear model, where <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span> is the outcome or dependent variable (<span class="math inline">\(N \times 1\)</span>), <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span> are various exogenous covariates (<span class="math inline">\(N \times k\)</span>), and <span class="math inline">\(\boldsymbol{\mathbf{\varepsilon}}\)</span> (<span class="math inline">\(N \times 1\)</span>) is the error term. We are usually interested in the coefficient vector <span class="math inline">\(\boldsymbol{\mathbf{\beta}}\)</span> (<span class="math inline">\(k \times 1\)</span>) and its insecurity estimates.</p>
<p><span class="math display">\[
{\boldsymbol{\mathbf{y}}}={\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
\]</span> The work-horse for estimating <span class="math inline">\(\boldsymbol{\mathbf{\beta}}\)</span> in the social science is the OLS estimator <span class="citation" data-cites="Wooldridge.2010">(<a href="references.html#ref-Wooldridge.2010" role="doc-biblioref">Wooldridge 2010</a>)</span>.</p>
<p><span class="math display">\[
\hat{\beta}=({\boldsymbol{\mathbf{X}}}^\intercal{\boldsymbol{\mathbf{X}}})^{-1}{\boldsymbol{\mathbf{X}}}^\intercal{\boldsymbol{\mathbf{y}}}.
\]</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
OLS assumptions I
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p><span class="math inline">\(\mathrm{E}(\epsilon_i|\boldsymbol{\mathbf{X}}_i) = 0\)</span>: for every value of <span class="math inline">\(X\)</span>, the average / expectation of the error term <span class="math inline">\(\boldsymbol{\mathbf{\varepsilon}}\)</span> equals zero – put differently: the error term is independent of <span class="math inline">\(X\)</span>,</p></li>
<li><p>the observations of the sample are independent and identically distributed (i.i.d),</p></li>
<li><p>the fourth moments of the variables <span class="math inline">\(\boldsymbol{\mathbf{X}}_i\)</span> and <span class="math inline">\(Y_i\)</span> are positive and definite – put differently: extreme values / outliers are very very rare,</p></li>
<li><p><span class="math inline">\(\text{rank}(\boldsymbol{\mathbf{X}}) = K\)</span>: the matrix <span class="math inline">\(\boldsymbol{\mathbf{X}}\)</span> has full rank – put differently: no perfect multicollinearity between the covariates,</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
OLS assumptions II
</div>
</div>
<div class="callout-body-container callout-body">
<ol start="5" type="1">
<li><p><span class="math inline">\(\mathrm{Var}(\varepsilon|x) = \sigma^2\)</span>: the error terms <span class="math inline">\(\varepsilon\)</span> are homoskedastic / have the same variance given any value of the explanatory variable,</p></li>
<li><p><span class="math inline">\(\varepsilon \sim \mathcal{N}(0, \sigma^2)\)</span>: the error terms <span class="math inline">\(\varepsilon\)</span> are normally distributed (conditional on the explanatory variables <span class="math inline">\(X_i\)</span>).</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which of the six assumptions above may be violated by spatial dependence?</p>
</div>
</div>
<p><img src="fig/assumptions.jpg" class="img-fluid"></p>
</section><section id="problem-of-ignoring-spatial-dependence" class="level3" data-number="4.1.2"><h3 data-number="4.1.2" class="anchored" data-anchor-id="problem-of-ignoring-spatial-dependence">
<span class="header-section-number">4.1.2</span> Problem of ignoring spatial dependence</h3>
<p>Does spatial dependence influence the results / coefficient estimates of non-spatial regression models, or in other words: is ignoring spatial dependence harmful?</p>
<p>I’ve heard different answers, ranging from “It only affects the standard errors” to “it always introduces bias”. As so often, the true (or best?) answer is somewhere in the middle: <em>it depends</em> <span class="citation" data-cites="Betz.2020 Cook.2020 Pace.2010 Ruttenauer.2022a">(<a href="references.html#ref-Betz.2020" role="doc-biblioref">Betz, Cook, and Hollenbach 2020</a>; <a href="references.html#ref-Cook.2020" role="doc-biblioref">Cook, Hays, and Franzese 2020</a>; <a href="references.html#ref-Pace.2010" role="doc-biblioref">Pace and LeSage 2010</a>; <a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">Rüttenauer 2022</a>)</span>.</p>
<p>The easiest way to think of it is analogous to the omit variable bias <span class="citation" data-cites="Betz.2020 Cook.2020">(<a href="references.html#ref-Betz.2020" role="doc-biblioref">Betz, Cook, and Hollenbach 2020</a>; <a href="references.html#ref-Cook.2020" role="doc-biblioref">Cook, Hays, and Franzese 2020</a>)</span>:</p>
<p><span class="math display">\[
plim~\hat{\beta}_{OLS}= \beta  + \gamma \frac{\mathrm{Cov}(\boldsymbol{\mathbf{x}}, \boldsymbol{\mathbf{z}})}{\mathrm{Var}(\boldsymbol{\mathbf{x}})},
\]</span></p>
<p>where <span class="math inline">\(z\)</span> is some omit variable, and <span class="math inline">\(\gamma\)</span> is the conditional effect of <span class="math inline">\(\boldsymbol{\mathbf{z}}\)</span> on <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span>. Now imagine that the neighbouring values of the dependent variable <span class="math inline">\(\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{y}}\)</span> are autocorrelated to focal unit which we denote with <span class="math inline">\(\rho &gt; 0\)</span>, and that the covariance between the focal unit’s exogenous covariates and <span class="math inline">\(\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{y}}\)</span> is not zero. Then we will have an omitted variable bias due to spatial dependence:</p>
<p><span class="math display">\[
plim~\hat{\beta}_{OLS}= \beta  + \rho \frac{\mathrm{Cov}(\boldsymbol{\mathbf{x}}, \boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{y}})}{\mathrm{Var}(\boldsymbol{\mathbf{x}})} \neq \beta,
\]</span></p>
<p>For completeness, the entire bias is a bit more complicated <span class="citation" data-cites="Pace.2010 Ruttenauer.2022a">(<a href="references.html#ref-Pace.2010" role="doc-biblioref">Pace and LeSage 2010</a>; <a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">Rüttenauer 2022</a>)</span> and looks like:</p>
<p><span class="math display">\[
plim~\hat{\beta}=\frac{\sum_{ij}({\boldsymbol{\mathbf{M}}}(\delta){\boldsymbol{\mathbf{M}}}(\delta)^\intercal\circ{\boldsymbol{\mathbf{M}}}(\rho))_{ij}}
{\mathrm{tr}({\boldsymbol{\mathbf{M}}}(\delta){\boldsymbol{\mathbf{M}}}(\delta)^\intercal)}\beta \\
+\frac{\sum_{ij}({\boldsymbol{\mathbf{M}}}(\delta){\boldsymbol{\mathbf{M}}}(\delta)^\intercal\circ{\boldsymbol{\mathbf{M}}}(\rho){\boldsymbol{\mathbf{W}}})_{ij}}
{\mathrm{tr}({\boldsymbol{\mathbf{M}}}(\delta){\boldsymbol{\mathbf{M}}}(\delta)^\intercal)}\theta,
\]</span> where <span class="math inline">\(\circ\)</span> denotes the Hadamard product, <span class="math inline">\({\boldsymbol{\mathbf{M}}}(\delta)=({\boldsymbol{\mathbf{I}}}_N-\delta{\boldsymbol{\mathbf{W}}})^{-1}\)</span>, and <span class="math inline">\({\boldsymbol{\mathbf{M}}}(\rho)=({\boldsymbol{\mathbf{I}}}_N-\rho{\boldsymbol{\mathbf{W}}})^{-1}\)</span>.</p>
<p>
</p>
<center>
<em>(Don’t worry, no need to learn by hard!!)</em>
</center>

<p>Essentially, the non-spatial OLS estimator <span class="math inline">\(\beta_{OLS}\)</span> is biased in the presence of either <span class="citation" data-cites="Pace.2010 Ruttenauer.2022a">(<a href="references.html#ref-Pace.2010" role="doc-biblioref">Pace and LeSage 2010</a>; <a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">Rüttenauer 2022</a>)</span>:</p>
<ul>
<li><p>Spatial autocorrelation in the dependent variable (<span class="math inline">\(\rho\neq0\)</span>) and spatial autocorrelation in the covariate (<span class="math inline">\(\delta\neq0\)</span>). This bias increases with <span class="math inline">\(\rho\)</span>, <span class="math inline">\(\delta\)</span>, and <span class="math inline">\(\beta\)</span>.</p></li>
<li><p>Local spatial spillover effects (<span class="math inline">\(\theta\neq0\)</span>) and spatial autocorrelation in the covariate (<span class="math inline">\(\delta\neq0\)</span>). This is analogous to the omitted variable bias resulting from the omission of <span class="math inline">\({\boldsymbol{\mathbf{W}}} {\boldsymbol{\mathbf{x}}}\)</span>. It increases with <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\delta\)</span>, but additionally with <span class="math inline">\(\rho\)</span> if <span class="math inline">\(\theta\neq0\)</span> and <span class="math inline">\(\delta\neq0\)</span>.</p></li>
<li><p>An omitted variable and <span class="math inline">\(\mathrm{E}({\boldsymbol{\mathbf{\varepsilon}}}|{\boldsymbol{\mathbf{x}}})\neq0\)</span>. This non-spatial omitted variable bias <span class="math inline">\(\gamma\)</span> is amplified by spatial dependence in the disturbances (<span class="math inline">\(\lambda\)</span>) and spatial autocorrelation in the dependent variable (<span class="math inline">\(\rho\)</span>), but also increases with positive values of <span class="math inline">\(\delta\)</span> if either <span class="math inline">\(\rho\neq 0\)</span> or <span class="math inline">\(\lambda\neq 0\)</span>. Obviously, it also increases with <span class="math inline">\(\gamma\)</span>.</p></li>
</ul></section></section><section id="spatial-regression-models" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="spatial-regression-models">
<span class="header-section-number">4.2</span> Spatial Regression Models</h2>
<p>Broadly, spatial dependence or clustering in some characteristic can be the result of three different processes:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TD
  id1{Spatial dependence} --&gt; A[Spatial interdepence]
  id1 --&gt; B[Spillovers from covariates]
  id1 --&gt; C[Clustering unobservables]
</pre>
</div>
</div>
</div>
</div>
<p>Strictly speaking, there are some other possibilities too, such as measurement error or the wrong choice on the spatial level. For instance, imagine we have a city-specific characteristic (e.g.&nbsp;public spending) allocated to neighbourhood units. Obviously, this will introduce heavy autocorrelation on the neigbourhood level by construction.</p>
<p>There are three basic ways of incorporating spatial dependence, which then can be further combined. As before, the <span class="math inline">\(N \times N\)</span> spatial weights matrix <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> defines the spatial relationship between units.</p>
<section id="spatial-error-model-sem" class="level3" data-number="4.2.1"><h3 data-number="4.2.1" class="anchored" data-anchor-id="spatial-error-model-sem">
<span class="header-section-number">4.2.1</span> Spatial Error Model (SEM)</h3>
<ul>
<li>Clustering on Unobservables</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
<p><span class="math inline">\(\lambda\)</span> denotes the strength of the spatial correlation in the errors of the model: <em>your errors influence my errors</em>.</p>
<ul>
<li>
<span class="math inline">\(&gt; 0\)</span>: positive error dependence,</li>
<li>
<span class="math inline">\(&lt; 0\)</span>: negative error dependence,</li>
<li>
<span class="math inline">\(= 0\)</span>: traditional OLS model.</li>
</ul>
<p><span class="math inline">\(\lambda\)</span> is defined in the range <span class="math inline">\([-1, +1]\)</span>.</p>
</section><section id="spatial-autoregressive-model-sar" class="level3" data-number="4.2.2"><h3 data-number="4.2.2" class="anchored" data-anchor-id="spatial-autoregressive-model-sar">
<span class="header-section-number">4.2.2</span> Spatial Autoregressive Model (SAR)</h3>
<ul>
<li>Interdependence</li>
</ul>
<p><span class="math display">\[
    \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}  
\]</span></p>
<p><span class="math inline">\(\rho\)</span> denotes the strength of the spatial correlation in the dependent variable (spatial autocorrelation): <em>your outcome influences my outcome</em>.</p>
<ul>
<li>
<span class="math inline">\(&gt; 0\)</span>: positive spatial dependence,</li>
<li>
<span class="math inline">\(&lt; 0\)</span>: negative spatial dependence,</li>
<li>
<span class="math inline">\(= 0\)</span>: traditional OLS model.</li>
</ul>
<p><span class="math inline">\(\rho\)</span> is defined in the range <span class="math inline">\([-1, +1]\)</span>.</p>
</section><section id="spatially-lagged-x-model-slx" class="level3" data-number="4.2.3"><h3 data-number="4.2.3" class="anchored" data-anchor-id="spatially-lagged-x-model-slx">
<span class="header-section-number">4.2.3</span> Spatially lagged X Model (SLX)</h3>
<ul>
<li>Spillovers in Covariates</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}
\]</span></p>
<p><span class="math inline">\(\theta\)</span> denotes the strength of the spatial spillover effects from covariate(s) on the dependent variable: <em>your covariates influence my outcome</em>.</p>
<p><span class="math inline">\(\theta\)</span> is basically like any other coefficient from a covariate. It is thus not bound to any range.</p>
<p>Moreover, there are models combining two sets of the above specifications.</p>
</section><section id="spatial-durbin-model-sdm" class="level3" data-number="4.2.4"><h3 data-number="4.2.4" class="anchored" data-anchor-id="spatial-durbin-model-sdm">
<span class="header-section-number">4.2.4</span> Spatial Durbin Model (SDM)</h3>
<ul>
<li>Interdependence</li>
<li>Spillovers in Covariates</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}
        \end{equation}
\]</span></p>
</section><section id="spatial-durbin-error-model-sdem" class="level3" data-number="4.2.5"><h3 data-number="4.2.5" class="anchored" data-anchor-id="spatial-durbin-error-model-sdem">
<span class="header-section-number">4.2.5</span> Spatial Durbin Error Model (SDEM)</h3>
<ul>
<li>Clustering on Unobservables</li>
<li>Spillovers in Covariates</li>
</ul>
<p><span class="math display">\[
    \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
</section><section id="combined-spatial-autocorrelation-model-sac" class="level3" data-number="4.2.6"><h3 data-number="4.2.6" class="anchored" data-anchor-id="combined-spatial-autocorrelation-model-sac">
<span class="header-section-number">4.2.6</span> Combined Spatial Autocorrelation Model (SAC)</h3>
<ul>
<li>Clustering on Unobservables</li>
<li>Interdependence</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
</section><section id="general-nesting-spatial-model-gns" class="level3" data-number="4.2.7"><h3 data-number="4.2.7" class="anchored" data-anchor-id="general-nesting-spatial-model-gns">
<span class="header-section-number">4.2.7</span> General Nesting Spatial Model (GNS)</h3>
<ul>
<li>Clustering on Unobservables</li>
<li>Interdependence</li>
<li>Spillovers in Covariates</li>
</ul>
<p><span class="math display">\[
        \begin{equation}
        \begin{split}
        {\boldsymbol{\mathbf{y}}}&amp;=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\theta}}}+ {\boldsymbol{\mathbf{u}}},\\
        {\boldsymbol{\mathbf{u}}}&amp;=\lambda{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{u}}}+{\boldsymbol{\mathbf{\varepsilon}}}
        \end{split}
        \end{equation}
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Manski’s reflection problem
</div>
</div>
<div class="callout-body-container callout-body">
<p>The General Nesting Spatial Model (GNS) is only weakly (or not?) identifiable <span class="citation" data-cites="Gibbons.2012">(<a href="references.html#ref-Gibbons.2012" role="doc-biblioref">Gibbons and Overman 2012</a>)</span>.</p>
<p>It’s analogous to Manski’s reflection problem on neighbourhood effects : If people in the same group behave similar, this can be because a) imitating behaviour of the group, b) exogenous characteristics of the group influence the behaviour, and c) members of the same group are exposed to the same external circumstances. <em>We just cannot separate those in observational data.</em></p>
</div>
</div>
<p>Note that all of these models assume different data generating processes (DGP) leading to the spatial pattern. Although there are specifications tests, it is generally not possible to let the data decide which one is the true underlying DGP <span class="citation" data-cites="Cook.2020 Ruttenauer.2022a">(<a href="references.html#ref-Cook.2020" role="doc-biblioref">Cook, Hays, and Franzese 2020</a>; <a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">Rüttenauer 2022</a>)</span>. However, there might be theoretical reasons to guide the model specification <span class="citation" data-cites="Cook.2020">(<a href="references.html#ref-Cook.2020" role="doc-biblioref">Cook, Hays, and Franzese 2020</a>)</span>.</p>
<p>Just because SAR is probably the most commonly used model does not make it the best choice. In contrast, various studies <span class="citation" data-cites="HalleckVega.2015 Ruttenauer.2022a Wimpy.2021">(<a href="references.html#ref-HalleckVega.2015" role="doc-biblioref">Halleck Vega and Elhorst 2015</a>; <a href="references.html#ref-Ruttenauer.2022a" role="doc-biblioref">Rüttenauer 2022</a>; <a href="references.html#ref-Wimpy.2021" role="doc-biblioref">Wimpy, Whitten, and Williams 2021</a>)</span> highlight the advantages of the relative simple SLX model. Moreover, this specification can basically be incorporated in any other statistical method.</p>
</section><section id="a-note-on-missings" class="level3" data-number="4.2.8"><h3 data-number="4.2.8" class="anchored" data-anchor-id="a-note-on-missings">
<span class="header-section-number">4.2.8</span> A note on missings</h3>
<p>Missing values create a problem in spatial data analysis. For instance, in a local spillover model with an average of 10 neighbours, two initial missing values will lead to 20 missing values in the spatially lagged variable. For global spillover models, one initial missing will ‘flow’ through the neighbourhood system until the cutoff point (and create an excess amount of missings).</p>
<p>Depending on the data, units with missings can either be dropped and omitted from the initial weights creation, or we need to impute the data first, e.g.&nbsp;using interpolation or Kriging.</p>
</section></section><section id="mini-example" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="mini-example">
<span class="header-section-number">4.3</span> Mini Example</h2>
<p>Let’s try to make sense of this. We rely on a mini example using a few units in Camden</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sub.spdf</span> <span class="op">&lt;-</span> <span class="va">msoa.spdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">172</span>, <span class="fl">175</span>, <span class="fl">178</span>, <span class="fl">179</span>, <span class="fl">181</span>, <span class="fl">182</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu">mapview</span><span class="op">(</span><span class="va">sub.spdf</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3f38617b046ce8789547" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-3f38617b046ce8789547">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-0.1565961810277428,-0.1565621291688229,-0.1561161391752801,-0.1548510528391938,-0.1535821992257756,-0.1535424182710838,-0.1530200943600667,-0.1528526870741887,-0.152387690842118,-0.1520018175416038,-0.1513499438055472,-0.150934528162429,-0.1497891784823291,-0.1497627587363702,-0.1497506137993357,-0.149207377373133,-0.1490079158263397,-0.1494350312491631,-0.1489960282517966,-0.1486832802732731,-0.1479562374076216,-0.1466846639329612,-0.1466425292250502,-0.1464330525450029,-0.1462665964145119,-0.1459513200147044,-0.145767181914827,-0.1473507349857443,-0.1489236031677559,-0.1490280268621478,-0.1527051927682176,-0.1547622112389522,-0.1549920392869104,-0.1551619010211504,-0.1558177890425833,-0.1602324585126904,-0.1603016713058847,-0.1595685144376535,-0.1602380102493793,-0.1603164311977012,-0.1606092016478036,-0.1594788171450109,-0.1580917310496925,-0.1574750230091186,-0.1572786658643164,-0.1572140351657218,-0.1581404199648046,-0.1573176607835105,-0.1573203220293627,-0.1578353179826342,-0.1578531051804155,-0.1576998304905309,-0.1565961810277428],"lat":[51.55002597202142,51.54960415927427,51.54965483737762,51.54979884450761,51.54995197801016,51.54990888963841,51.5492073598288,51.54930659067492,51.54910828733675,51.54938035524422,51.54844223615364,51.5478364241181,51.54786685444905,51.54750984226089,51.54728589162403,51.54727884285531,51.54680890701236,51.5467370149048,51.54678091480181,51.54600546188898,51.54609097049921,51.54638823399675,51.54623542506145,51.54547574233862,51.54492594837875,51.54399912258492,51.54369582832624,51.54250353699784,51.54290551750571,51.54292652585264,51.54383820081117,51.5433356297498,51.54311654638171,51.54277907822524,51.54282139444902,51.54281482968234,51.54378051636106,51.54381169543806,51.54461193036294,51.54466677303389,51.54487156227568,51.54566327973935,51.54665174878739,51.54646751278798,51.54672083032458,51.54708071780279,51.54752569704966,51.54755338742098,51.54790517748854,51.54789386822759,51.54889750577878,51.54993609052421,51.55002597202142]}]],[[{"lng":[-0.1290511603919327,-0.1270156412910638,-0.1268185896917965,-0.1264130149318957,-0.126169061432653,-0.1260345461755074,-0.1259252655827959,-0.1254895469828958,-0.1251267744943634,-0.1250868491910553,-0.1275595638055575,-0.1288417667790926,-0.1307090321462351,-0.1310642514035696,-0.1311490477061834,-0.131479776768059,-0.1316290756510355,-0.1337161360863567,-0.1350608679717091,-0.1358622530520394,-0.135430777031773,-0.1375884025505576,-0.1386819092547585,-0.1392283027261765,-0.1398115201810598,-0.139241248392946,-0.1381185054088004,-0.1380028637413495,-0.1385980697551056,-0.1377065407016392,-0.1369019077175228,-0.1359036180684664,-0.1360343172764695,-0.1353879708398678,-0.1350068200533165,-0.134458568598944,-0.1335969470577946,-0.1323366737592542,-0.1330393274557298,-0.1325449113736009,-0.1331309318068674,-0.1318189457461024,-0.1313381855238831,-0.1313057030702803,-0.1310056637668808,-0.1305221888213215,-0.1290511603919327],"lat":[51.54891359764778,51.54728400200028,51.54668544616003,51.54504014475017,51.54398497367272,51.54339708182046,51.54292692677242,51.5417475255223,51.54118814203544,51.54112167896388,51.54106063569859,51.54110558925996,51.54112542940364,51.54211791449049,51.54236959792019,51.54302602917912,51.5430138661577,51.54261765027546,51.54226772654623,51.54198828877777,51.54160750685766,51.54088946935806,51.5421170755513,51.54274836374275,51.54339154564734,51.54355734253664,51.54332358436086,51.54369124051593,51.54395464201737,51.54459694343882,51.54417051455671,51.5448200994046,51.54500520873111,51.54513307107979,51.54649036068933,51.54643375917566,51.54563771028569,51.54653889678168,51.5469042578718,51.54723762623914,51.54812428486905,51.54822757767758,51.54836191234548,51.54833097345242,51.54810032121888,51.54786174552819,51.54891359764778]}]],[[{"lng":[-0.1452833702045562,-0.1454004277296121,-0.144862115357176,-0.144560523343867,-0.1441303779406858,-0.143696356316306,-0.1429489279848135,-0.1425906494968043,-0.142349359847161,-0.142738828797887,-0.1433192356003094,-0.1442355727639823,-0.1439175441924202,-0.1442157666502525,-0.144181741834967,-0.1451611275826897,-0.1458834036967301,-0.1462892300605688,-0.1457413682615797,-0.1462180647712677,-0.1451561813851605,-0.1447361978631724,-0.145410075005851,-0.1459647459462523,-0.145515066079112,-0.1465594258883928,-0.1465935503649763,-0.1462481213929463,-0.1468225557242382,-0.149172866847961,-0.1521892710090795,-0.1527332713230438,-0.1546689802736061,-0.1594428091002754,-0.1604880559844402,-0.1616701479067003,-0.1602767246150978,-0.1598480998731665,-0.161622575940185,-0.162193201135668,-0.162214499466601,-0.1602324585160756,-0.1558177890390069,-0.1551619010251319,-0.1549920392846359,-0.1547622112468032,-0.1527051927691413,-0.1490280268610657,-0.148923603170033,-0.1473507349839679,-0.1457671819149066,-0.1459513200111432,-0.1462665964077753,-0.1464330525491846,-0.1451411984229711,-0.144190872218451,-0.1452833702045562],"lat":[51.54489305309229,51.54410117533246,51.54473175834818,51.54451158360385,51.54492232675316,51.54388804464833,51.54390950593734,51.54382591444892,51.54314814493159,51.54297276245833,51.54332382492802,51.5432524004348,51.54246572656896,51.54217953825614,51.5417181453033,51.54135755132511,51.54176793728565,51.5415549164166,51.54104178125712,51.54076386711961,51.5406077894717,51.54018856520175,51.54008663459654,51.53971867164321,51.5390005388419,51.53755216181877,51.53706710776923,51.53674756093124,51.53614389000501,51.53709328916652,51.53754208365326,51.53751957310364,51.53735816580212,51.53636102705545,51.53728145085012,51.53822830701842,51.53981350393742,51.54029023346351,51.54143320657387,51.54231579873196,51.54234483624612,51.54281482967947,51.54282139445133,51.54277907822296,51.54311654638376,51.54333562974689,51.54383820080739,51.54292652585172,51.54290551750528,51.5425035370011,51.54369582832668,51.54399912258182,51.54492594837627,51.54547574233982,51.54530867588642,51.54527800020656,51.54489305309229]}]],[[{"lng":[-0.1415553306426859,-0.1415619276696095,-0.1417154808292695,-0.1416375721466357,-0.1411024632819983,-0.1399863555646372,-0.1398115201795313,-0.1392283027254977,-0.1386819092493322,-0.1375884025522539,-0.1354307770315214,-0.1358622530471668,-0.1350608679693927,-0.1337161360898506,-0.1316290756553749,-0.1314797767740732,-0.1311490476990955,-0.1310642514049991,-0.1320711023407222,-0.1317059111534895,-0.1318100218233321,-0.131764407936391,-0.131076997763326,-0.1297653748728304,-0.1282192712795014,-0.1288144875720824,-0.1300585270464518,-0.1299058945108782,-0.1314747178092062,-0.1321079503122738,-0.1312431445951303,-0.1318564600761313,-0.1330485800710113,-0.1336892714968231,-0.1343608875607525,-0.1349572618096332,-0.1350499150633093,-0.136742451324494,-0.1369150497266801,-0.1377163231394098,-0.137786652862316,-0.1386987505374297,-0.1399866266363949,-0.1411880809023894,-0.1419425918801914,-0.1414946343942553,-0.1418557613886739,-0.1419939864533784,-0.1414304640084064,-0.1416923482786998,-0.1406256245258262,-0.1414967036532339,-0.142245768555113,-0.1421187319715125,-0.1433435788745769,-0.1433012097588881,-0.1442157666509058,-0.1439175441889249,-0.1442355727694229,-0.1433192356051457,-0.1427388288010761,-0.1423493598495211,-0.1425906494963021,-0.1429489279873354,-0.1436963563199204,-0.1441303779430793,-0.1445605233433271,-0.144862115359464,-0.1454004277262325,-0.1452833702018299,-0.1441908722126247,-0.1432935298257953,-0.1415553306426859],"lat":[51.54517377387049,51.5442979316542,51.54371800311067,51.5427885219528,51.54334703720827,51.54357396918311,51.54339154564602,51.54274836373827,51.54211707555003,51.54088946936072,51.54160750685877,51.5419882887737,51.54226772654589,51.54261765027719,51.5430138661596,51.54302602918016,51.54236959791766,51.54211791448945,51.54197228338257,51.54181395573409,51.54119022284729,51.54053705617466,51.5404118756404,51.5405277935296,51.5371925337048,51.53690381145538,51.53732683523207,51.53555733355968,51.53567116032487,51.53535060913366,51.53489704924358,51.53462252043008,51.53517889883604,51.53475838952033,51.53448578237057,51.53530840168767,51.53562667984436,51.53547294304526,51.5351582587835,51.53508873649764,51.53516165791224,51.53619559254765,51.53755478313399,51.5372230750001,51.53807059030396,51.53869085417072,51.53902459300924,51.53988407929005,51.53998531068449,51.53939108248564,51.53979610688666,51.54042336705661,51.54032279855934,51.54107890568822,51.54141764614641,51.5421971257965,51.54217953825668,51.54246572657312,51.54325240043676,51.54332382492829,51.54297276246293,51.54314814493008,51.54382591444499,51.54390950593763,51.543888044652,51.54492232675135,51.54451158360338,51.54473175834585,51.54410117533617,51.54489305308989,51.5452780002039,51.54524353322734,51.54517377387049]}]],[[{"lng":[-0.1433435788724305,-0.1421187319743669,-0.1422457685465365,-0.1414967036571894,-0.1406256245245263,-0.1416923482757257,-0.1414304640095624,-0.1419939864505043,-0.141855761382538,-0.14149463439154,-0.1419425918754155,-0.1411880808996668,-0.1399866266370269,-0.138698750535694,-0.1377866528664244,-0.1377163231347666,-0.1373858860716459,-0.1354865813413596,-0.1355206710908903,-0.1361987765634167,-0.1375255610621457,-0.1380064731307845,-0.1382096304052674,-0.1393024247128553,-0.1391408534123229,-0.1401118130332246,-0.1424115337906108,-0.1436311025250366,-0.1439120189113954,-0.1435303030980143,-0.1430977523415888,-0.1436347927917935,-0.1433436757056205,-0.1447678561364179,-0.1451361094755241,-0.1448069778666078,-0.1443232805884888,-0.1445544220863077,-0.1437783992097689,-0.1435866262707094,-0.1445592770788401,-0.1443953584820014,-0.1438599725900701,-0.1438539467976228,-0.144371872292879,-0.1443576674411622,-0.1437341449863052,-0.1438869568022217,-0.1447387077281746,-0.1447305561283627,-0.1447437040914843,-0.1443107839101241,-0.1442743530688713,-0.1439607079583281,-0.1424770339805936,-0.1418653297590048,-0.1395055922496938,-0.139526991496891,-0.1401406378101857,-0.1386477852413599,-0.1384403054633242,-0.1382477620294848,-0.137209893295893,-0.1365492514052699,-0.1369790198805436,-0.1404377152635942,-0.1408370966515385,-0.1435216531882054,-0.1434163201372213,-0.1439915156610118,-0.1441565566011673,-0.1446421500175874,-0.1452164657770743,-0.1458149262512528,-0.1471391552654182,-0.1471963364443291,-0.1484401584057518,-0.1487180421256795,-0.1505706269302737,-0.1523353669207397,-0.1527332713209429,-0.1521892710035491,-0.1491728668444386,-0.1468225557280106,-0.1462481213879849,-0.1465935503749081,-0.1465594258872199,-0.1455150660869344,-0.1459647459466339,-0.1454100749948933,-0.1447361978598057,-0.1451561813800512,-0.1462180647739401,-0.1457413682638175,-0.1462892300666695,-0.1458834036953697,-0.1451611275762769,-0.1441817418427088,-0.1442157666477471,-0.143301209760113,-0.1433435788724305],"lat":[51.54141764615107,51.54107890569176,51.54032279856118,51.54042336705913,51.53979610688695,51.53939108249039,51.53998531068417,51.53988407928977,51.53902459300694,51.53869085417503,51.53807059030207,51.53722307500109,51.53755478313262,51.53619559254321,51.53516165791421,51.53508873650255,51.53474607451152,51.53522201713573,51.53441283086712,51.53359583953625,51.53287211879083,51.53270590153441,51.53266196046427,51.53249830753547,51.53191321163748,51.53177954181528,51.53317017648904,51.53433276746953,51.53421906042016,51.53341344531509,51.53278132529731,51.53264580157904,51.53193460147663,51.53141669503923,51.53134588461867,51.53090726946191,51.53102393978016,51.53062542543255,51.53060344545697,51.53016729693581,51.53000283605177,51.52942472450989,51.52938373735049,51.52912885804556,51.52916306748742,51.52857883512033,51.52806575955535,51.52754231523505,51.52769464258606,51.52742100731919,51.52688228679744,51.52694746867822,51.52566395261266,51.52566955642047,51.52566065676672,51.52563283961105,51.52632260441234,51.52688796889153,51.52715895883878,51.52718445958296,51.52652735011008,51.52628314267942,51.52653973145718,51.52551511887308,51.52544339603163,51.52449142464437,51.52438672513442,51.52394814582248,51.52454107098038,51.52468716514939,51.52399623087852,51.52405840715205,51.52403098038737,51.52526903120345,51.52505048622186,51.52504104808102,51.52785192673194,51.52847985995339,51.53262598891134,51.53660041023572,51.53751957310659,51.53754208365457,51.53709328916813,51.53614389000244,51.53674756093447,51.53706710776991,51.53755216181317,51.53900053883854,51.53971867164299,51.54008663459769,51.54018856520167,51.54060778947226,51.54076386711738,51.54104178125929,51.54155491641529,51.54176793728317,51.54135755132692,51.54171814530406,51.54217953825079,51.54219712579829,51.54141764615107]}]],[[{"lng":[-0.1310642514065463,-0.1307090321406218,-0.1288417667716753,-0.127559563803689,-0.1250868491948901,-0.1235377008831693,-0.1224626293289875,-0.1224166425841038,-0.1223342315127545,-0.1223386765949858,-0.122396532596371,-0.1225272359682728,-0.1225565942668296,-0.1225876639536418,-0.1238161617189812,-0.1243777361424246,-0.1269661977934118,-0.1307915671594112,-0.1319224684088995,-0.1333519208853346,-0.1347404045042909,-0.1351383920780973,-0.1352800283182951,-0.1367928078141281,-0.1391169716300326,-0.1391408534195554,-0.1393024247156015,-0.1382096303963641,-0.1380064731347557,-0.1375255610690957,-0.1361987765618987,-0.135520671078987,-0.135486581338082,-0.1373858860744593,-0.1377163231360151,-0.1369150497316698,-0.1367424513311728,-0.1350499150605745,-0.1349572618138595,-0.1343608875601125,-0.1336892714885692,-0.1330485800757548,-0.1318564600756631,-0.1312431446001361,-0.1321079503073768,-0.1314747178091691,-0.1299058945136495,-0.1300585270445321,-0.1288144875742687,-0.1282192712765046,-0.1297653748698539,-0.1310769977615974,-0.1317644079391023,-0.1318100218195892,-0.1317059111567024,-0.1320711023351724,-0.1310642514065463],"lat":[51.54211791449188,51.54112542940649,51.54110558926116,51.54106063569827,51.54112167896093,51.53904485128107,51.53712964955651,51.53695241784448,51.53568730245616,51.53551867436755,51.53358890207855,51.53172954642601,51.53072580556931,51.53069321941447,51.53003558634924,51.52978960254725,51.52878471171748,51.52732003690572,51.52837036404146,51.52964680819125,51.53088834834493,51.53121989836786,51.53118399481766,51.53097456969277,51.53182672976948,51.53191321163523,51.53249830753909,51.5326619604649,51.53270590153294,51.53287211878487,51.53359583954053,51.53441283086109,51.53522201713555,51.53474607450571,51.53508873650091,51.53515825878055,51.53547294304698,51.53562667984789,51.53530840169203,51.53448578237154,51.53475838952581,51.53517889883338,51.53462252043131,51.53489704924732,51.53535060913554,51.53567116032138,51.53555733355428,51.53732683523074,51.53690381145278,51.5371925337071,51.54052779353403,51.54041187564564,51.54053705617179,51.54119022284959,51.5418139557388,51.54197228338498,51.54211791449188]}]]],null,"sub.spdf",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>172&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000177&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 012&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>8948&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>8863&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td> 85&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td>170.9&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3865&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.3&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 012&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>8948&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>5728&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>4132&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>330&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td>15&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td>1251&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>529&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td>156&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td> 86&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td>131&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>156&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td>1237&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td> 91&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>41&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td> 682&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>124&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>299&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td>1105&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>661&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td>191&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td>253&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>349&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td>145&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>204&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>8948&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>690&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>6643&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>265&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>717&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td> 54&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>129&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>273&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>246&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td> 4&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>75&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td>168&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3865&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td>1013&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>477&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>536&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td> 22&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td>1898&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td>1736&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>162&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td> 894&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td> 841&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td> 53&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>38&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>64.01430&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>371.9789&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>34.69809&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>5.911936&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td>13.824318&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td>12.349128&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>3.900313&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>26.20957&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>49.10737&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>25.75995&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>14.18194&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td> 8.616451&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>376812.5&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>175&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000180&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 015&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>8202&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>7662&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td>540&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td>169.0&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3394&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.3&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 015&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>8202&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>5419&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>3800&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>260&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td> 8&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td>1351&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>487&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td>122&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td> 62&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td>112&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>191&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td>1195&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td>146&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>40&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td> 498&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>256&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>255&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td> 899&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>541&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td>153&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td>205&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>202&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td> 85&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>117&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>8202&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>438&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>6004&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>265&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>776&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td> 99&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>122&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>364&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>246&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td> 7&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>59&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td>172&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>2&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3394&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td> 986&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>441&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>545&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td> 16&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td>1298&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td> 903&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>395&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td>1054&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td> 972&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td> 82&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>40&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>66.06925&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>344.7731&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>37.85584&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>5.937576&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td>14.569617&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td>10.960741&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>2.462814&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>29.05127&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>38.24396&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>26.79834&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>12.89929&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td>10.668130&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>414625.0&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>178&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000183&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 018&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>7913&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>7909&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td>  4&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td>102.5&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3881&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.0&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 018&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>7913&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>6110&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>4227&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>290&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td>1592&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>408&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td> 63&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td> 58&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td>152&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>135&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td> 706&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td>145&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>17&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td> 246&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>119&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>179&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td> 452&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>273&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td> 96&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td> 83&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>237&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td> 58&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>179&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>7913&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>338&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>5744&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>227&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>778&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td> 91&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>103&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>226&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>614&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td>36&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>57&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td>285&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3881&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td>1515&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>890&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>625&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td> 20&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td>1130&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td> 476&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>654&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td>1153&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td>1047&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td>106&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>63&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>77.21471&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>127.2276&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>35.82704&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>5.156072&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td> 8.922027&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td> 5.712119&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>2.995071&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>39.03633&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>29.11621&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>27.41059&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>13.55996&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td>10.981928&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>713125.0&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>179&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000184&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 019&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>8882&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>8726&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td>156&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td>133.6&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3655&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.4&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 019&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>8882&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>5241&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>3550&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>314&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td>13&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td>1364&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>542&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td>142&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td> 81&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td>146&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>173&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td>1697&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td>186&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>36&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td> 909&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>246&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>320&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td>1061&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>680&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td>152&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td>229&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>341&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td>170&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>171&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>8882&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>510&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>6328&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>253&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>894&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td> 89&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>132&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>480&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>215&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td>15&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>85&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td>168&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3655&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td> 740&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>313&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>427&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td>124&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td>1674&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td>1350&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>324&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td>1086&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td>1018&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td> 68&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>31&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>59.00698&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>273.1369&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>38.80696&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>6.102229&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td>19.106057&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td>11.945508&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>3.839225&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>20.24624&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>45.80027&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>28.75478&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>14.83900&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td>11.067327&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>322750.0&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>181&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000186&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 021&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>6687&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>6491&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td>196&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td> 66.7&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3099&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.1&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 021&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>6687&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>4643&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>2958&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>250&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td>1432&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>302&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td> 63&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td> 48&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td> 78&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>113&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td> 922&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td>201&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>29&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td> 254&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>136&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>302&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td> 574&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>354&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td> 71&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td>149&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>246&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td>103&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>143&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>6687&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>332&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>4415&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>204&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>821&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td>112&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>103&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>522&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>331&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td>10&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>51&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td>209&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3099&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td> 860&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>497&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>363&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td> 25&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td> 865&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td> 519&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>346&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td>1272&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td>1175&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td> 97&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>77&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>69.43323&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>9&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>341.1536&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>40.68699&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>4.516226&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td>13.787947&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td> 8.583819&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>3.678780&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>27.75089&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>27.91223&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>33.97637&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>16.97323&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td>13.952445&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>495000.0&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>182&emsp;<\/td><\/tr><tr><td>1<\/td><th>MSOA11CD&emsp;<\/th><td>E02000187&emsp;<\/td><\/tr><tr><td>2<\/td><th>MSOA11NM&emsp;<\/th><td>Camden 022&emsp;<\/td><\/tr><tr><td>3<\/td><th>LAD11CD&emsp;<\/th><td>E09000007&emsp;<\/td><\/tr><tr><td>4<\/td><th>LAD11NM&emsp;<\/th><td>Camden&emsp;<\/td><\/tr><tr><td>5<\/td><th>RGN11CD&emsp;<\/th><td>E12000007&emsp;<\/td><\/tr><tr><td>6<\/td><th>RGN11NM&emsp;<\/th><td>London&emsp;<\/td><\/tr><tr><td>7<\/td><th>USUALRES&emsp;<\/th><td>8155&emsp;<\/td><\/tr><tr><td>8<\/td><th>HHOLDRES&emsp;<\/th><td>8064&emsp;<\/td><\/tr><tr><td>9<\/td><th>COMESTRES&emsp;<\/th><td> 91&emsp;<\/td><\/tr><tr><td>10<\/td><th>POPDEN&emsp;<\/th><td> 84.2&emsp;<\/td><\/tr><tr><td>11<\/td><th>HHOLDS&emsp;<\/th><td>3290&emsp;<\/td><\/tr><tr><td>12<\/td><th>AVHHOLDSZ&emsp;<\/th><td>2.5&emsp;<\/td><\/tr><tr><td>13<\/td><th>name&emsp;<\/th><td>Camden 022&emsp;<\/td><\/tr><tr><td>14<\/td><th>KS201EW0001&emsp;<\/th><td>8155&emsp;<\/td><\/tr><tr><td>15<\/td><th>KS201EW_100&emsp;<\/th><td>3838&emsp;<\/td><\/tr><tr><td>16<\/td><th>KS201EW0002&emsp;<\/th><td>2602&emsp;<\/td><\/tr><tr><td>17<\/td><th>KS201EW0003&emsp;<\/th><td>240&emsp;<\/td><\/tr><tr><td>18<\/td><th>KS201EW0004&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>19<\/td><th>KS201EW0005&emsp;<\/th><td> 991&emsp;<\/td><\/tr><tr><td>20<\/td><th>KS201EW_200&emsp;<\/th><td>450&emsp;<\/td><\/tr><tr><td>21<\/td><th>KS201EW0006&emsp;<\/th><td> 74&emsp;<\/td><\/tr><tr><td>22<\/td><th>KS201EW0007&emsp;<\/th><td>126&emsp;<\/td><\/tr><tr><td>23<\/td><th>KS201EW0008&emsp;<\/th><td> 80&emsp;<\/td><\/tr><tr><td>24<\/td><th>KS201EW0009&emsp;<\/th><td>170&emsp;<\/td><\/tr><tr><td>25<\/td><th>KS201EW_300&emsp;<\/th><td>2295&emsp;<\/td><\/tr><tr><td>26<\/td><th>KS201EW0010&emsp;<\/th><td>144&emsp;<\/td><\/tr><tr><td>27<\/td><th>KS201EW0011&emsp;<\/th><td>51&emsp;<\/td><\/tr><tr><td>28<\/td><th>KS201EW0012&emsp;<\/th><td>1511&emsp;<\/td><\/tr><tr><td>29<\/td><th>KS201EW0013&emsp;<\/th><td>257&emsp;<\/td><\/tr><tr><td>30<\/td><th>KS201EW0014&emsp;<\/th><td>332&emsp;<\/td><\/tr><tr><td>31<\/td><th>KS201EW_400&emsp;<\/th><td>1225&emsp;<\/td><\/tr><tr><td>32<\/td><th>KS201EW0015&emsp;<\/th><td>817&emsp;<\/td><\/tr><tr><td>33<\/td><th>KS201EW0016&emsp;<\/th><td>161&emsp;<\/td><\/tr><tr><td>34<\/td><th>KS201EW0017&emsp;<\/th><td>247&emsp;<\/td><\/tr><tr><td>35<\/td><th>KS201EW_500&emsp;<\/th><td>347&emsp;<\/td><\/tr><tr><td>36<\/td><th>KS201EW0018&emsp;<\/th><td>134&emsp;<\/td><\/tr><tr><td>37<\/td><th>KS201EW0019&emsp;<\/th><td>213&emsp;<\/td><\/tr><tr><td>38<\/td><th>KS205EW0001&emsp;<\/th><td>8155&emsp;<\/td><\/tr><tr><td>39<\/td><th>KS205EW0002&emsp;<\/th><td>608&emsp;<\/td><\/tr><tr><td>40<\/td><th>KS205EW0003&emsp;<\/th><td>5946&emsp;<\/td><\/tr><tr><td>41<\/td><th>KS205EW0004&emsp;<\/th><td>198&emsp;<\/td><\/tr><tr><td>42<\/td><th>KS205EW0005&emsp;<\/th><td>714&emsp;<\/td><\/tr><tr><td>43<\/td><th>KS205EW0006&emsp;<\/th><td> 66&emsp;<\/td><\/tr><tr><td>44<\/td><th>KS205EW0007&emsp;<\/th><td>131&emsp;<\/td><\/tr><tr><td>45<\/td><th>KS205EW0008&emsp;<\/th><td>477&emsp;<\/td><\/tr><tr><td>46<\/td><th>KS205EW0009&emsp;<\/th><td>104&emsp;<\/td><\/tr><tr><td>47<\/td><th>KS205EW0010&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>48<\/td><th>KS205EW0011&emsp;<\/th><td>73&emsp;<\/td><\/tr><tr><td>49<\/td><th>KS205EW0012&emsp;<\/th><td> 72&emsp;<\/td><\/tr><tr><td>50<\/td><th>KS205EW0013&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>51<\/td><th>KS402EW0001&emsp;<\/th><td>3290&emsp;<\/td><\/tr><tr><td>52<\/td><th>KS402EW_100&emsp;<\/th><td> 396&emsp;<\/td><\/tr><tr><td>53<\/td><th>KS402EW0002&emsp;<\/th><td>168&emsp;<\/td><\/tr><tr><td>54<\/td><th>KS402EW0003&emsp;<\/th><td>228&emsp;<\/td><\/tr><tr><td>55<\/td><th>KS402EW0004&emsp;<\/th><td> 12&emsp;<\/td><\/tr><tr><td>56<\/td><th>KS402EW_200&emsp;<\/th><td>2288&emsp;<\/td><\/tr><tr><td>57<\/td><th>KS402EW0005&emsp;<\/th><td>1583&emsp;<\/td><\/tr><tr><td>58<\/td><th>KS402EW0006&emsp;<\/th><td>705&emsp;<\/td><\/tr><tr><td>59<\/td><th>KS402EW_300&emsp;<\/th><td> 541&emsp;<\/td><\/tr><tr><td>60<\/td><th>KS402EW0007&emsp;<\/th><td> 505&emsp;<\/td><\/tr><tr><td>61<\/td><th>KS402EW0008&emsp;<\/th><td> 36&emsp;<\/td><\/tr><tr><td>62<\/td><th>KS402EW0009&emsp;<\/th><td>53&emsp;<\/td><\/tr><tr><td>63<\/td><th>per_white&emsp;<\/th><td>47.06315&emsp;<\/td><\/tr><tr><td>64<\/td><th>ulez&emsp;<\/th><td>0&emsp;<\/td><\/tr><tr><td>65<\/td><th>pubs_count&emsp;<\/th><td>7&emsp;<\/td><\/tr><tr><td>66<\/td><th>dist_pubs&emsp;<\/th><td>213.7841&emsp;<\/td><\/tr><tr><td>67<\/td><th>no2&emsp;<\/th><td>42.94646&emsp;<\/td><\/tr><tr><td>68<\/td><th>per_mixed&emsp;<\/th><td>5.518087&emsp;<\/td><\/tr><tr><td>69<\/td><th>per_asian&emsp;<\/th><td>28.142244&emsp;<\/td><\/tr><tr><td>70<\/td><th>per_black&emsp;<\/th><td>15.021459&emsp;<\/td><\/tr><tr><td>71<\/td><th>per_other&emsp;<\/th><td>4.255058&emsp;<\/td><\/tr><tr><td>72<\/td><th>per_owner&emsp;<\/th><td>12.03647&emsp;<\/td><\/tr><tr><td>73<\/td><th>per_social&emsp;<\/th><td>69.54407&emsp;<\/td><\/tr><tr><td>74<\/td><th>per_nonUK&emsp;<\/th><td>27.08768&emsp;<\/td><\/tr><tr><td>75<\/td><th>per_nonEU&emsp;<\/th><td>15.09503&emsp;<\/td><\/tr><tr><td>76<\/td><th>per_nonUK_EU&emsp;<\/th><td> 9.564684&emsp;<\/td><\/tr><tr><td>77<\/td><th>med_house_price&emsp;<\/th><td>364000.0&emsp;<\/td><\/tr><tr><td>78<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["172","175","178","179","181","182"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-0.162214499466601,51.52394814582248,-0.1223342315127545,51.55002597202142,true,"sub.spdf","Zoom to sub.spdf","<strong> sub.spdf <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sub.spdf",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["sub.spdf"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"sub.spdf"}]}],"limits":{"lat":[51.52394814582248,51.55002597202142],"lng":[-0.162214499466601,-0.1223342315127545]},"fitBounds":[51.52394814582248,-0.162214499466601,51.55002597202142,-0.1223342315127545,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>We then construct queens neighbours, and have a look at the resulting non-normalized matrix <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">queens.nb</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">sub.spdf</span>, queen <span class="op">=</span> <span class="cn">TRUE</span>, snap <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">nb2mat</span><span class="op">(</span><span class="va">queens.nb</span>, style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="va">W</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    [,1] [,2] [,3] [,4] [,5] [,6]
172    0    0    1    0    0    0
175    0    0    0    1    0    1
178    1    0    0    1    1    0
179    0    1    1    0    1    1
181    0    0    1    1    0    1
182    0    1    0    1    1    0
attr(,"call")
nb2mat(neighbours = queens.nb, style = "B")</code></pre>
</div>
</div>
<p>We have selected 6 units. So, <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> is a <span class="math inline">\(6 \times 6\)</span> matrix. we see that observation 1 has one neighbour: observation 3. Observation 2 has two neighbours: observation 4 and observation 6. The diagonal is zero: no unit is a neighbour of themselves.</p>
<p>No we row-normalize this matrix.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">queens.lw</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">queens.nb</span>,</span>
<span>                      style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">W_rn</span> <span class="op">&lt;-</span> <span class="fu">listw2mat</span><span class="op">(</span><span class="va">queens.lw</span><span class="op">)</span></span>
<span><span class="va">W_rn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
172 0.0000000 0.0000000 1.0000000 0.0000000 0.0000000 0.0000000
175 0.0000000 0.0000000 0.0000000 0.5000000 0.0000000 0.5000000
178 0.3333333 0.0000000 0.0000000 0.3333333 0.3333333 0.0000000
179 0.0000000 0.2500000 0.2500000 0.0000000 0.2500000 0.2500000
181 0.0000000 0.0000000 0.3333333 0.3333333 0.0000000 0.3333333
182 0.0000000 0.3333333 0.0000000 0.3333333 0.3333333 0.0000000</code></pre>
</div>
</div>
<p>No every single weight <span class="math inline">\(w_{ij}\)</span> is divided by the total number of neighbours <span class="math inline">\(n_i\)</span> of the focal unit. For observation 1, observation 3 is the only neighbour, thus a weight = 1. For observation two, both neighbours have a weight of 1/2. For observation 3 (with three neighbours) each neighbour got a weight of 1/3.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>What happens if we multiply this matrix <span class="math inline">\(\boldsymbol{\mathbf{W}}\)</span> with a <span class="math inline">\(N \times 1\)</span> vector <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span> or <span class="math inline">\(\boldsymbol{\mathbf{x}}\)</span>?</p>
</div>
</div>
<p>A short reminder on matrix multiplication.</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{W}} * \boldsymbol{\mathbf{y}} =
\begin{bmatrix}
w_{11} &amp; w_{12} &amp; w_{13}\\
w_{21} &amp; w_{22} &amp; w_{23}\\
w_{31} &amp; w_{32} &amp; w_{33}
\end{bmatrix} *
\begin{bmatrix}
y_{11} \\
y_{21} \\
y_{31}  
\end{bmatrix}\\
= \begin{bmatrix}
w_{11}y_{11} + w_{12}y_{21} + w_{13}y_{31}\\
w_{21}y_{11} + w_{22}y_{21} + w_{23}y_{31}\\
w_{31}y_{11} + w_{32}y_{21} + w_{33}y_{31}  
\end{bmatrix}
\]</span></p>
<p>Each line of <span class="math inline">\(\boldsymbol{\mathbf{W}} * \boldsymbol{\mathbf{y}}\)</span> just gives a weighted average of the other <span class="math inline">\(y\)</span>-values <span class="math inline">\(y_j\)</span> in the sample. In case of the row-normalization, each neighbour gets the same weight <span class="math inline">\(\frac{1}{n_i}\)</span>. This is simply the mean of <span class="math inline">\(y_j\)</span> of the neighbours in case of a row-normalized contiguity weights matrix.</p>
<p>Note that the <em>mean</em> interpretation is only valid with row-normalization. What would we get with inverse-distance based weights?</p>
<p>Let’s look at this in our example</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">sub.spdf</span><span class="op">$</span><span class="va">med_house_price</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">sub.spdf</span><span class="op">$</span><span class="va">pubs_count</span></span>
<span></span>
<span><span class="va">W_rn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
172 0.0000000 0.0000000 1.0000000 0.0000000 0.0000000 0.0000000
175 0.0000000 0.0000000 0.0000000 0.5000000 0.0000000 0.5000000
178 0.3333333 0.0000000 0.0000000 0.3333333 0.3333333 0.0000000
179 0.0000000 0.2500000 0.2500000 0.0000000 0.2500000 0.2500000
181 0.0000000 0.0000000 0.3333333 0.3333333 0.0000000 0.3333333
182 0.0000000 0.3333333 0.0000000 0.3333333 0.3333333 0.0000000</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 376812.5 414625.0 713125.0 322750.0 495000.0 364000.0</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 3 1 9 7</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">W_rn_y</span> <span class="op">&lt;-</span> <span class="va">W_rn</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">y</span></span>
<span><span class="va">W_rn_x</span> <span class="op">&lt;-</span> <span class="va">W_rn</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">x</span></span>
<span><span class="va">W_rn_y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
172 713125.0
175 343375.0
178 398187.5
179 496687.5
181 466625.0
182 410791.7</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">W_rn_x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
172 3.000000
175 4.000000
178 3.666667
179 5.500000
181 3.666667
182 4.333333</code></pre>
</div>
</div>
<p>Let’s check if our interpretation is true</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">W_rn_y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">y</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">W_rn_y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">W_rn_y</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section><section id="real-example" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="real-example">
<span class="header-section-number">4.4</span> Real Example</h2>
<p>First, we need the a spatial weights matrix.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Contiguity (Queens) neighbours weights</span></span>
<span><span class="va">queens.nb</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">msoa.spdf</span>, </span>
<span>                     queen <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     snap <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># we consider points in 1m distance as 'touching'</span></span>
<span><span class="va">queens.lw</span> <span class="op">&lt;-</span> <span class="fu">nb2listw</span><span class="op">(</span><span class="va">queens.nb</span>,</span>
<span>                      style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can estimate spatial models using <code>spatialreg</code>.</p>
<section id="sar" class="level3" data-number="4.4.1"><h3 data-number="4.4.1" class="anchored" data-anchor-id="sar">
<span class="header-section-number">4.4.1</span> SAR</h3>
<p>Lets estimate a spatial SAR model using the <code>lagsarlm()</code> with contiguity weights. We use median house value as depended variable, and include population density (<code>POPDEN</code>), the air pollution (<code>no2</code>), and the share of ethnic minorities (<code>per_mixed</code>, <code>per_asian</code>, <code>per_black</code>, <code>per_other</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sar</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                        <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                      data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                      listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                      Durbin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># we could here extend to SDM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lagsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = FALSE)

Residuals:
       Min         1Q     Median         3Q        Max 
-0.5281789 -0.1220524 -0.0099245  0.0992203  1.0936745 

Type: lag 
Coefficients: (asymptotic standard errors) 
               Estimate  Std. Error  z value  Pr(&gt;|z|)
(Intercept)  3.17383180  0.29041604  10.9286 &lt; 2.2e-16
log(no2)     0.39705423  0.04452880   8.9168 &lt; 2.2e-16
log(POPDEN) -0.05583014  0.01242876  -4.4920 7.055e-06
per_mixed    0.01851577  0.00579832   3.1933  0.001407
per_asian   -0.00228346  0.00045876  -4.9775 6.442e-07
per_black   -0.01263650  0.00100282 -12.6009 &lt; 2.2e-16
per_other   -0.00161419  0.00289082  -0.5584  0.576582

Rho: 0.66976, LR test value: 473.23, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.025311
    z-value: 26.461, p-value: &lt; 2.22e-16
Wald statistic: 700.19, p-value: &lt; 2.22e-16

Log likelihood: 196.7203 for lag model
ML residual variance (sigma squared): 0.035402, (sigma: 0.18815)
Number of observations: 983 
Number of parameters estimated: 9 
AIC: -375.44, (AIC for lm: 95.786)
LM test for residual autocorrelation
test value: 8.609, p-value: 0.0033451</code></pre>
</div>
</div>
<p>This looks pretty much like a conventional model output, with some additional information: a highly significant <code>mod_1.sar$rho</code> of 0.67 indicates strong positive spatial autocorrelation.</p>
<p>Remember that is the coefficient for the term <span class="math inline">\(\boldsymbol{\mathbf{y}} = \rho \boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{y}} \ldots\)</span>. It is bound to be below 1 for positive autocorrelation.</p>
<p>In substantive terms, house prices in the focal unit positively influence house prices in neighbouring units, which again influences house prices among the neighbours of these neighbours, and so on (we’ll get back to this).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The coefficients of covariates in a SAR model are not marginal or partial effects, because of the spillovers and feedback loops in <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span> (see below)!</p>
<p>From the coefficient, we can only interpret the direction: there’s a positive effect of air pollution and a negative effect of population sensitivity, and so on…</p>
</div>
</div>
</section><section id="sem" class="level3" data-number="4.4.2"><h3 data-number="4.4.2" class="anchored" data-anchor-id="sem">
<span class="header-section-number">4.4.2</span> SEM</h3>
<p>SEM models can be estimated using <code>errorsarlm()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sem</span> <span class="op">&lt;-</span> <span class="fu">errorsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span></span>
<span>                          <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                        data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                        listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                        Durbin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># we could here extend to SDEM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sem</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
errorsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = FALSE)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.581785 -0.105218 -0.012758  0.094430  0.913425 

Type: error 
Coefficients: (asymptotic standard errors) 
               Estimate  Std. Error  z value  Pr(&gt;|z|)
(Intercept) 12.92801104  0.35239139  36.6865 &lt; 2.2e-16
log(no2)     0.15735296  0.10880727   1.4462 0.1481317
log(POPDEN) -0.08316270  0.01254315  -6.6301 3.354e-11
per_mixed   -0.03377962  0.00811054  -4.1649 3.115e-05
per_asian   -0.00413115  0.00096849  -4.2656 1.994e-05
per_black   -0.01653816  0.00126741 -13.0488 &lt; 2.2e-16
per_other   -0.01693012  0.00462999  -3.6566 0.0002556

Lambda: 0.88605, LR test value: 623.55, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.015803
    z-value: 56.068, p-value: &lt; 2.22e-16
Wald statistic: 3143.6, p-value: &lt; 2.22e-16

Log likelihood: 271.8839 for error model
ML residual variance (sigma squared): 0.026911, (sigma: 0.16405)
Number of observations: 983 
Number of parameters estimated: 9 
AIC: NA (not available for weighted model), (AIC for lm: 95.786)</code></pre>
</div>
</div>
<p>In this case <code>mod_1.sem$lambda</code> gives us the spatial parameter. A highly significant lambda of 0.89 indicates that the errors are highly spatially correlated (e.g.&nbsp;due to correlated unobservables). Again, $= 1 $ would be the maximum.</p>
<p>In spatial error models, we can interpret the coefficients directly, as in a conventional linear model.</p>
</section><section id="slx" class="level3" data-number="4.4.3"><h3 data-number="4.4.3" class="anchored" data-anchor-id="slx">
<span class="header-section-number">4.4.3</span> SLX</h3>
<p>SLX models can either be estimated with <code>lmSLX()</code> directly, or by creating <span class="math inline">\(\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{X}}\)</span> manually and plugging it into any available model-fitting function.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.slx</span> <span class="op">&lt;-</span> <span class="fu">lmSLX</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                     <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                   data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                   listw <span class="op">=</span> <span class="va">queens.lw</span>, </span>
<span>                   Durbin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># use a formula to lag only specific covariates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.slx</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula(paste("y ~ ", paste(colnames(x)[-1], collapse = "+"))), 
    data = as.data.frame(x), weights = weights)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.50809 -0.16605 -0.01817  0.13055  1.09039 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     10.582440   0.153862  68.779  &lt; 2e-16 ***
log.no2.        -0.440727   0.181063  -2.434  0.01511 *  
log.POPDEN.     -0.076840   0.017345  -4.430 1.05e-05 ***
per_mixed       -0.033042   0.011298  -2.925  0.00353 ** 
per_asian       -0.002381   0.001474  -1.615  0.10655    
per_black       -0.016229   0.001801  -9.009  &lt; 2e-16 ***
per_other       -0.020391   0.006564  -3.107  0.00195 ** 
lag.log.no2.     0.993602   0.199370   4.984 7.38e-07 ***
lag.log.POPDEN.  0.113262   0.028752   3.939 8.76e-05 ***
lag.per_mixed    0.126069   0.014294   8.820  &lt; 2e-16 ***
lag.per_asian   -0.003828   0.001661  -2.305  0.02140 *  
lag.per_black   -0.018054   0.002241  -8.056 2.30e-15 ***
lag.per_other    0.048139   0.007971   6.039 2.20e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2262 on 970 degrees of freedom
Multiple R-squared:  0.653, Adjusted R-squared:  0.6487 
F-statistic: 152.1 on 12 and 970 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>In SLX models, we can simply interpret the coefficients of direct and indirect (spatially lagged) covariates.</p>
<p>For instance, lets look at population density:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretaion SLX
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>A high population density in the focal unit is related to lower house prices (a 1% increase in population density decreses house prices by -0.08%), but</p></li>
<li><p>A high population density in the neighbouring areas is related to higher house prices (while keeping population density in the focal unit constant). A 1% increase in the <em>average</em> population density <em>across the adjacent neighbourhoods</em> increases house prices in <em>the focal unit</em> by 0.11%)</p></li>
</ol>
<p>Potential interpretation: areas with a low population density in central regions of the city (high pop density in surrounding neighbourhoods) have higher house prices. We could try testing this interpretation by including the distance to the city center as a control.</p>
</div>
</div>
<p>Also note how the air pollution coefficient has changed here, with a negative effect in the focal unit and positive one amonf the neighbouring units.</p>
<p>An alternative way of estimating the same model is lagging the covariates first.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Loop through vars and create lagged variables</span></span>
<span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">log_POPDEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">POPDEN</span><span class="op">)</span></span>
<span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">log_no2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">no2</span><span class="op">)</span></span>
<span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">log_med_house_price</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">msoa.spdf</span><span class="op">$</span><span class="va">med_house_price</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"log_med_house_price"</span>, <span class="st">"log_no2"</span>, <span class="st">"log_POPDEN"</span>, </span>
<span>          <span class="st">"per_mixed"</span>, <span class="st">"per_asian"</span>, <span class="st">"per_black"</span>, <span class="st">"per_other"</span>,</span>
<span>          <span class="st">"per_owner"</span>, <span class="st">"per_social"</span>, <span class="st">"pubs_count"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">vars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">msoa.spdf</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"w."</span>, <span class="va">v</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">lag.listw</span><span class="op">(</span><span class="va">queens.lw</span>,</span>
<span>                                            var <span class="op">=</span> <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="va">msoa.spdf</span><span class="op">)</span><span class="op">[</span>, <span class="va">v</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Alternatively:</span></span>
<span><span class="va">w_vars</span> <span class="op">&lt;-</span> <span class="fu">create_WX</span><span class="op">(</span><span class="fu">st_drop_geometry</span><span class="op">(</span><span class="va">msoa.spdf</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                    prefix <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">w_vars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  w.log_med_house_price w.log_no2 w.log_POPDEN w.per_mixed
1              12.98382  3.843750     4.662014    4.748368
2              12.28730  3.098960     3.300901    3.978275
3              12.21207  3.206338     4.009795    3.997487
4              12.18176  3.169934     3.630360    2.759082
5              12.11159  3.221203     3.993660    3.930061
6              12.08393  3.217865     3.876070    3.419488
  w.per_asian w.per_black w.per_other w.per_owner w.per_social
1   23.899916    7.879758   3.2080074    25.75738     33.85580
2   19.951593   10.451828   1.6368986    66.42278     15.75042
3   20.793559   12.965863   1.7526693    58.72637     21.38169
4    7.633439   12.135478   0.6992118    66.52519     19.70500
5   12.791140   16.108948   1.3817357    53.05539     29.44022
6    8.997514   15.312652   0.9611710    59.49460     23.81126
  w.pubs_count
1    8.5454545
2    0.6666667
3    0.2857143
4    0.2000000
5    0.4000000
6    0.1666667</code></pre>
</div>
</div>
<p>And subsequently we use those new variables in a linear model.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                  <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span> <span class="op">+</span></span>
<span>                  <span class="va">w.log_no2</span> <span class="op">+</span> <span class="va">w.log_POPDEN</span> <span class="op">+</span></span>
<span>                  <span class="va">w.per_mixed</span> <span class="op">+</span> <span class="va">w.per_asian</span> <span class="op">+</span> <span class="va">w.per_black</span> <span class="op">+</span> <span class="va">w.per_other</span>,</span>
<span>                data <span class="op">=</span> <span class="va">msoa.spdf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other + w.log_no2 + 
    w.log_POPDEN + w.per_mixed + w.per_asian + w.per_black + 
    w.per_other, data = msoa.spdf)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.50809 -0.16605 -0.01817  0.13055  1.09039 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  10.582440   0.153862  68.779  &lt; 2e-16 ***
log(no2)     -0.440727   0.181063  -2.434  0.01511 *  
log(POPDEN)  -0.076840   0.017345  -4.430 1.05e-05 ***
per_mixed    -0.033042   0.011298  -2.925  0.00353 ** 
per_asian    -0.002381   0.001474  -1.615  0.10655    
per_black    -0.016229   0.001801  -9.009  &lt; 2e-16 ***
per_other    -0.020391   0.006564  -3.107  0.00195 ** 
w.log_no2     0.993602   0.199370   4.984 7.38e-07 ***
w.log_POPDEN  0.113262   0.028752   3.939 8.76e-05 ***
w.per_mixed   0.126069   0.014294   8.820  &lt; 2e-16 ***
w.per_asian  -0.003828   0.001661  -2.305  0.02140 *  
w.per_black  -0.018054   0.002241  -8.056 2.30e-15 ***
w.per_other   0.048139   0.007971   6.039 2.20e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2262 on 970 degrees of freedom
Multiple R-squared:  0.653, Adjusted R-squared:  0.6487 
F-statistic: 152.1 on 12 and 970 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Looks pretty similar to <code>lmSLX()</code> results, and it should! A big advantage of the SLX specification is that we can use the lagged variables in basically all methods which take variables as inputs, such as non-linear models, matching algorithms, and machine learning tools.</p>
<p>Moreover, using the lagged variables gives a high degree of freedom. For instance, we could (not saying that it necessarily makes sense):</p>
<ul>
<li><p>Use different weights matrices for different variables</p></li>
<li><p>Include higher order neighbours using <code>nblag()</code> (with an increasing number of orders we go towards a more global model, but we estimate a coefficient for each spillover, instead of estimating just one)</p></li>
<li><p>Use machine learning techniques to determine the best fitting weights specification.</p></li>
</ul></section><section id="sdem" class="level3" data-number="4.4.4"><h3 data-number="4.4.4" class="anchored" data-anchor-id="sdem">
<span class="header-section-number">4.4.4</span> SDEM</h3>
<p>SDEM models can be estimated using <code>errorsarlm()</code> with the additional option <code>Durbin = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sdem</span> <span class="op">&lt;-</span> <span class="fu">errorsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span></span>
<span>                          <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                        data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                        listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                        Durbin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># we could here extend to SDEM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sdem</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
errorsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = TRUE)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.617795 -0.106380 -0.014832  0.095826  0.927446 

Type: error 
Coefficients: (asymptotic standard errors) 
                  Estimate Std. Error  z value  Pr(&gt;|z|)
(Intercept)     10.4422703  0.3652148  28.5921 &lt; 2.2e-16
log(no2)        -0.2057493  0.1264914  -1.6266 0.1038248
log(POPDEN)     -0.0769743  0.0132094  -5.8272 5.635e-09
per_mixed       -0.0222406  0.0079705  -2.7904 0.0052649
per_asian       -0.0037484  0.0010054  -3.7284 0.0001927
per_black       -0.0179751  0.0012383 -14.5161 &lt; 2.2e-16
per_other       -0.0150218  0.0044895  -3.3460 0.0008199
lag.log(no2)     1.0004491  0.1739833   5.7503 8.911e-09
lag.log(POPDEN) -0.0054241  0.0327802  -0.1655 0.8685763
lag.per_mixed    0.0669699  0.0169349   3.9545 7.668e-05
lag.per_asian   -0.0018566  0.0015957  -1.1635 0.2446368
lag.per_black   -0.0079949  0.0024833  -3.2195 0.0012842
lag.per_other    0.0273378  0.0087430   3.1268 0.0017671

Lambda: 0.76173, LR test value: 455.7, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.024949
    z-value: 30.531, p-value: &lt; 2.22e-16
Wald statistic: 932.15, p-value: &lt; 2.22e-16

Log likelihood: 300.847 for error model
ML residual variance (sigma squared): 0.027504, (sigma: 0.16584)
Number of observations: 983 
Number of parameters estimated: 15 
AIC: NA (not available for weighted model), (AIC for lm: -117.99)</code></pre>
</div>
</div>
<p>And this SDEM can be interpreted like a combination of SEM and SLX.</p>
<p>First, we still see highly significant auto-correlation in the error term. However, it’s lower in magnitude now that we also include the <span class="math inline">\(\boldsymbol{\mathbf{W}} X\)</span> terms.</p>
<p>Second, the coefficients tell a smimilar story as in the SLX (use the same interpretation), but some coefficient magnitudes have become smaller.</p>
</section><section id="sdm" class="level3" data-number="4.4.5"><h3 data-number="4.4.5" class="anchored" data-anchor-id="sdm">
<span class="header-section-number">4.4.5</span> SDM</h3>
<p>SDM models can be estimated using <code>lagsarlm()</code> with the additional option <code>Durbin = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sdm</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                        <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                      data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                      listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                      Durbin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># we could here extend to SDM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sdm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lagsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = TRUE)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.614314 -0.107947 -0.013509  0.092234  0.917398 

Type: mixed 
Coefficients: (asymptotic standard errors) 
                  Estimate Std. Error  z value  Pr(&gt;|z|)
(Intercept)      2.7843426  0.2944721   9.4554 &lt; 2.2e-16
log(no2)        -0.3112762  0.1308101  -2.3796 0.0173312
log(POPDEN)     -0.0802866  0.0125213  -6.4120 1.436e-10
per_mixed       -0.0368998  0.0081596  -4.5223 6.118e-06
per_asian       -0.0033726  0.0010636  -3.1711 0.0015189
per_black       -0.0159770  0.0013006 -12.2848 &lt; 2.2e-16
per_other       -0.0209743  0.0047369  -4.4279 9.516e-06
lag.log(no2)     0.4880923  0.1456778   3.3505 0.0008067
lag.log(POPDEN)  0.0781188  0.0207600   3.7629 0.0001679
lag.per_mixed    0.0640880  0.0104646   6.1243 9.110e-10
lag.per_asian    0.0017665  0.0012101   1.4598 0.1443498
lag.per_black    0.0070487  0.0017938   3.9295 8.511e-05
lag.per_other    0.0284822  0.0057774   4.9299 8.226e-07

Rho: 0.73126, LR test value: 501.83, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.025889
    z-value: 28.246, p-value: &lt; 2.22e-16
Wald statistic: 797.86, p-value: &lt; 2.22e-16

Log likelihood: 323.9111 for mixed model
ML residual variance (sigma squared): 0.026633, (sigma: 0.1632)
Number of observations: 983 
Number of parameters estimated: 15 
AIC: -617.82, (AIC for lm: -117.99)
LM test for residual autocorrelation
test value: 36.704, p-value: 1.3747e-09</code></pre>
</div>
</div>
<p>And this SDM can be interpreted like a combination of SAR and SLX.</p>
<p>First, there’s still substantial auto-correlation in <span class="math inline">\(\boldsymbol{\mathbf{y}}\)</span>, and this has become even stronger as compared to SAR.</p>
<p>Second, we can interpret the direction of the effect, but we <em>cannot interpret the coefficient as marginal effects</em>.</p>
<!-- ## Examples -->
<!-- __@Boillat.2022__ -->
<!-- _The paper investigates the effects of protected areas and various land tenure regimes on deforestation and possible spillover effects in Bolivia, a global tropical deforestation hotspot._ -->
<!-- ![](fig/Boillat.png) -->
<!-- _Protected areas – which in Bolivia are all based on co-management schemes - also protect forests in adjacent areas, showing an indirect protective spillover effect. Indigenous lands however only have direct forest protection effects._ -->
<!-- __@Fischer.2009__ -->
<!-- _The focus of this paper is on the role of human capital in explaining labor productivity variation among 198 European regions within a regression framework._ -->
<!-- ![](fig/Fischer.png) -->
<!-- _A ceteris paribus increase in the level of human capital is found to have a significant and positive direct impact. But this positive direct impact is offset by a significant and negative indirect (spillover) impact leading to a total impact that is not significantly different from zero._ -->
<!-- _The intuition here arises from the notion that it is relative regional advantages in human capital that matter most for labor productivity, so changing human capital across all regions should have little or no total impact on (average) labor productivity levels._ -->
<!-- __@Ruttenauer.2018a__ -->
<!-- _This study investigates the presence of environmental inequality in Germany - the connection between the presence of foreign-minority population and objectively measured industrial pollution._ -->
<!-- ![](fig/census.png) -->
<!-- _Results reveal that the share of minorities within a census cell indeed positively correlates with the exposure to industrial pollution. Furthermore, spatial spillover effects are highly relevant: the characteristics of the neighbouring spatial units matter in predicting the amount of pollution. Especially within urban areas, clusters of high minority neighbourhoods are affected by high levels of environmental pollution._ -->
</section></section><section id="estimation" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="estimation">
<span class="header-section-number">4.5</span> Estimation</h2>
<p>Note that most of the spatial model specifications can not be estimated by Least Squares (LS), as using (constrained) LS estimators for models containing a spatially lagged dependent variable or disturbance leads to inconsistent results <span class="citation" data-cites="Anselin.1998 Franzese.2007">(<a href="references.html#ref-Anselin.1998" role="doc-biblioref">Anselin and Bera 1998</a>; <a href="references.html#ref-Franzese.2007" role="doc-biblioref">Franzese and Hays 2007</a>)</span>. However, an extensive amount of econometric literature discusses different estimation methods based on (quasi-) maximum likelihood <span class="citation" data-cites="Anselin.1988 Lee.2004 Ord.1975">(<a href="references.html#ref-Anselin.1988" role="doc-biblioref">Anselin 1988</a>; <a href="references.html#ref-Lee.2004" role="doc-biblioref">Lee 2004</a>; <a href="references.html#ref-Ord.1975" role="doc-biblioref">Ord 1975</a>)</span> or instrumental variable approaches using generalized methods of moments <span class="citation" data-cites="Drukker.2013 Kelejian.1998 Kelejian.2010">(<a href="references.html#ref-Drukker.2013" role="doc-biblioref">Drukker, Egger, and Prucha 2013</a>; <a href="references.html#ref-Kelejian.1998" role="doc-biblioref">Kelejian and Prucha 1998</a>, <a href="references.html#ref-Kelejian.2010" role="doc-biblioref">2010</a>)</span>, in which the endogenous lagged variables can be instrumented by <span class="math inline">\(q\)</span> higher order lags of the exogenous regressors <span class="math inline">\(({\boldsymbol{\mathbf{X}}}, {\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{X}}}, {\boldsymbol{\mathbf{W}}^2 \boldsymbol{\mathbf{X}}},..., {\boldsymbol{\mathbf{W}}^q \boldsymbol{\mathbf{X}}})\)</span> <span class="citation" data-cites="Kelejian.1998">(<a href="references.html#ref-Kelejian.1998" role="doc-biblioref">Kelejian and Prucha 1998</a>)</span>.</p>
<section id="simulataneity-bias" class="level3" data-number="4.5.1"><h3 data-number="4.5.1" class="anchored" data-anchor-id="simulataneity-bias">
<span class="header-section-number">4.5.1</span> Simulataneity bias</h3>
<p>Remember what is happening when we estimate a spatial auto-regressive model.</p>
<p><img src="fig/Graph.jpg" class="img-fluid"></p>
<p>Note the circular process here: My <span class="math inline">\(X\)</span> influences my <span class="math inline">\(Y\)</span>, which then influences your <span class="math inline">\(Y\)</span>, which then influences my <span class="math inline">\(Y\)</span> again. We write this as</p>
<p><span class="math display">\[
    \begin{equation}
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}.
        \end{equation}  
\]</span></p>
<p>If we ignore <span class="math inline">\({\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}\)</span> and write the pure auto-regressive term in its reduce form, we get:</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{y}} =\left(\boldsymbol{\mathbf{I}}_n - \rho\boldsymbol{\mathbf{W}}\right)^{-1}\varepsilon,
\]</span></p>
<p>and the spatial lag term is</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{y}} =\boldsymbol{\mathbf{W}}\left(\boldsymbol{\mathbf{I}}_n - \rho\boldsymbol{\mathbf{W}}\right)^{-1}\varepsilon.
\]</span></p>
<p>The OLS estimator for the spatial lag term then is</p>
<p><span class="math display">\[
\hat{\rho}_{OLS} = \left[\underbrace{\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)^\top}_{(1\times n)}\underbrace{\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)}_{(n\times 1)}\right]^{-1}\underbrace{\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)^\top}_{(1\times n)}\underbrace{\boldsymbol{\mathbf{y}}}_{(n\times 1)}.
\]</span></p>
<p>It can then be shown that the OLS estimators equals</p>
<p><span class="math display">\[
          \hat{\rho}_{OLS} = \rho + \left[\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)^\top\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)\right]^{-1}\left(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} \right)^\top\varepsilon \\
                                = \rho + \left(\sum_{i = 1}^n \boldsymbol{\mathbf{y}}_{Li}^2\right)^{-1}\left(\sum_{i = 1}^{n}\boldsymbol{\mathbf{y}}_{Li}\epsilon_i\right),
\]</span></p>
<p>with <span class="math inline">\(\boldsymbol{\mathbf{y}}_{Li}\)</span> defined as the <span class="math inline">\(i\)</span>th element of the spatial lag operator <span class="math inline">\(\boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{y}} = \boldsymbol{\mathbf{y}}_L\)</span>. It can further be shown that the second part of the equation <span class="math inline">\(\neq 0\)</span>, which demonstrates that OLS gives a biased estimate of <span class="math inline">\(\rho\)</span> <span class="citation" data-cites="Franzese.2007 Sarrias.2023">(<a href="references.html#ref-Franzese.2007" role="doc-biblioref">Franzese and Hays 2007</a>; <a href="references.html#ref-Sarrias.2023" role="doc-biblioref">Sarrias 2023</a>)</span>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not estimate spatial lags of the dependent variable in OLS. It will suffer from simultaneity bias.</p>
</div>
</div>
</section><section id="instrumental-variable" class="level3" data-number="4.5.2"><h3 data-number="4.5.2" class="anchored" data-anchor-id="instrumental-variable">
<span class="header-section-number">4.5.2</span> Instrumental variable</h3>
<p>A potential way of estimating spatial lag /SAR models is 2SLS <span class="citation" data-cites="Kelejian.1998">(<a href="references.html#ref-Kelejian.1998" role="doc-biblioref">Kelejian and Prucha 1998</a>)</span>.</p>
<p>We start with our standard model</p>
<p><span class="math display">\[
        {\boldsymbol{\mathbf{y}}}=\alpha{\boldsymbol{\mathbf{\iota}}}+\rho{\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}+{\boldsymbol{\mathbf{X}}}{\boldsymbol{\mathbf{\beta}}}+ {\boldsymbol{\mathbf{\varepsilon}}}.
\]</span></p>
<p>As we have seen above, there is a problem of simultaneity: the “covariate” <span class="math inline">\({\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}\)</span> is endogenous. One way of dealing with this endogeneity problem is the Instrumental Variable approach.</p>
<p>So, the question is what are good instruments <span class="math inline">\(\boldsymbol{\mathbf{H}}\)</span> for <span class="math inline">\({\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}\)</span>? As we have specified the mode, we are sure that <span class="math inline">\({\boldsymbol{\mathbf{X}}}\)</span> determines <span class="math inline">\({\boldsymbol{\mathbf{y}}}\)</span>. Thus, it must be true that <span class="math inline">\({\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{X}}}\)</span> and <span class="math inline">\({\boldsymbol{\mathbf{W}}}^2{\boldsymbol{\mathbf{X}}},\ldots, {\boldsymbol{\mathbf{W}}}^l{\boldsymbol{\mathbf{X}}}\)</span> determines <span class="math inline">\({\boldsymbol{\mathbf{W}}}{\boldsymbol{\mathbf{y}}}\)</span>.</p>
<p>Note that <span class="math inline">\({\boldsymbol{\mathbf{W}}}^l\)</span> denotes higher orders of <span class="math inline">\({\boldsymbol{\mathbf{W}}}\)</span>. So <span class="math inline">\({\boldsymbol{\mathbf{W}}}^2\)</span> are the second order neighbours (neighbours of neighbours), and <span class="math inline">\({\boldsymbol{\mathbf{W}}}^3\)</span> are the third order neighbours (the neighbours of my neighbour’s neighbours), and so on…</p>
<p>We will discuss this in more detail later, but note for now that the reduced form of the SAR always contains a series of higher order neighbours.</p>
<p><span class="math display">\[
({\boldsymbol{\mathbf{I}}_N}-\rho {\boldsymbol{\mathbf{W}}})^{-1}\beta_k
=({\boldsymbol{\mathbf{I}}_N} + \rho{\boldsymbol{\mathbf{W}}} + \rho^2{\boldsymbol{\mathbf{W}}}^2 + \rho^3{\boldsymbol{\mathbf{W}}}^3 + ...)\beta_k
= ({\boldsymbol{\mathbf{I}}_N} + \sum_{h=1}^\infty \rho^h{\boldsymbol{\mathbf{W}}}^h)\beta_k .
\]</span></p>
<p>Thus, <span class="citation" data-cites="Kelejian.1998">Kelejian and Prucha (<a href="references.html#ref-Kelejian.1998" role="doc-biblioref">1998</a>)</span> suggested to use a set of lagged covariates as instruments for <span class="math inline">\(\boldsymbol{\mathbf{W}} \boldsymbol{\mathbf{Y}}\)</span>:</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{H}} = \boldsymbol{\mathbf{X}}, \boldsymbol{\mathbf{W}}\boldsymbol{\mathbf{X}}, \boldsymbol{\mathbf{W}}^2\boldsymbol{\mathbf{X}}, ... , \boldsymbol{\mathbf{W}}^l\boldsymbol{\mathbf{X}},
\]</span></p>
<p>where <span class="math inline">\(l\)</span> is a pre-defined number for the higher order neighbours included. In practice, <span class="math inline">\(l\)</span> is usually restricted to <span class="math inline">\(l=2\)</span>.</p>
<p>This has further been developed by, for instance, using a (truncated) power series as instruments <span class="citation" data-cites="Kelejian.2004">(<a href="references.html#ref-Kelejian.2004" role="doc-biblioref">Kelejian, Prucha, and Yuzefovich 2004</a>)</span>:</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{H}} =\left[\boldsymbol{\mathbf{X}}, \boldsymbol{\mathbf{W}}\left(\sum_{l = 1}^{\infty}\rho^{l}\boldsymbol{\mathbf{W}}^l\right)\boldsymbol{\mathbf{X}} \boldsymbol{\mathbf{\beta}}\right].
\]</span></p>
<p>We can estimate this using the pacakge <code>spatialreg</code> with the function <code>stsls()</code>,</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sls</span> <span class="op">&lt;-</span> <span class="fu">stsls</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                     <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                   data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                   listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                   robust <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#  heteroskedasticity robust SEs</span></span>
<span>                   W2X <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Second order neighbours are included as instruments (else only first)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sls</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stsls(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, robust = TRUE, W2X = TRUE)

Residuals:
       Min         1Q     Median         3Q        Max 
-0.5464924 -0.1238002 -0.0052299  0.0989150  1.0793093 

Coefficients: 
               Estimate HC0 std. Error z value  Pr(&gt;|z|)
Rho          0.71004211     0.04678235 15.1776 &lt; 2.2e-16
(Intercept)  2.73582523     0.50997823  5.3646 8.113e-08
log(no2)     0.37752751     0.04920257  7.6729 1.688e-14
log(POPDEN) -0.05710992     0.01684036 -3.3913 0.0006957
per_mixed    0.01634307     0.00588488  2.7771 0.0054842
per_asian   -0.00205426     0.00045905 -4.4750 7.640e-06
per_black   -0.01166456     0.00128557 -9.0734 &lt; 2.2e-16
per_other   -0.00280423     0.00332302 -0.8439 0.3987377

Residual variance (sigma squared): 0.035213, (sigma: 0.18765)</code></pre>
</div>
</div>
</section></section><section id="maximum-likelihood" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="maximum-likelihood">
<span class="header-section-number">4.6</span> Maximum Likelihood</h2>
<p>Maximum Likelihood estimation of spatial models is the most common way of estimation. The procedure to estimate SAR models via ML is based on <span class="citation" data-cites="Ord.1975">Ord (<a href="references.html#ref-Ord.1975" role="doc-biblioref">1975</a>)</span> and <span class="citation" data-cites="Anselin.1988">Anselin (<a href="references.html#ref-Anselin.1988" role="doc-biblioref">1988</a>)</span>. If you are interested in more details, please look at the more extensive <a href="https://ruettenauer.github.io/Geodata_Spatial_Regression/06_regression-estimation.html">3-day workshop</a> or have a look into <span class="citation" data-cites="Sarrias.2023">Sarrias (<a href="references.html#ref-Sarrias.2023" role="doc-biblioref">2023</a>)</span>.</p>
<p>The package <code>spatialreg</code> <span class="citation" data-cites="Bivand.2021">Pebesma and Bivand (<a href="references.html#ref-Pebesma.2023" role="doc-biblioref">2023</a>)</span> provides a series of functions to calculate the ML estimator for all spatial models we have considered.</p>
<p>Table from <span class="citation" data-cites="Pebesma.2023">Pebesma and Bivand (<a href="references.html#ref-Pebesma.2023" role="doc-biblioref">2023</a>)</span>:</p>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 41%">
<col style="width: 50%">
</colgroup>
<thead><tr class="header">
<th>model</th>
<th>model name</th>
<th>maximum likelihood estimation function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>SEM</td>
<td>spatial error</td>
<td><code>errorsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="even">
<td>SEM</td>
<td>spatial error</td>
<td><code>spautolm(..., family="SAR")</code></td>
</tr>
<tr class="odd">
<td>SDEM</td>
<td>spatial Durbin error</td>
<td><code>errorsarlm(..., Durbin=TRUE)</code></td>
</tr>
<tr class="even">
<td>SLM</td>
<td>spatial lag</td>
<td><code>lagsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="odd">
<td>SDM</td>
<td>spatial Durbin</td>
<td><code>lagsarlm(..., Durbin=TRUE)</code></td>
</tr>
<tr class="even">
<td>SAC</td>
<td>spatial autoregressive combined</td>
<td><code>sacsarlm(..., Durbin=FALSE)</code></td>
</tr>
<tr class="odd">
<td>GNM</td>
<td>general nested</td>
<td><code>sacsarlm(..., Durbin=TRUE)</code></td>
</tr>
</tbody>
</table>
<p><strong>ML SAR</strong></p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sar</span> <span class="op">&lt;-</span> <span class="fu">lagsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                        <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                      data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                      listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                      Durbin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># we could here extend to SDM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lagsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = FALSE)

Residuals:
       Min         1Q     Median         3Q        Max 
-0.5281789 -0.1220524 -0.0099245  0.0992203  1.0936745 

Type: lag 
Coefficients: (asymptotic standard errors) 
               Estimate  Std. Error  z value  Pr(&gt;|z|)
(Intercept)  3.17383180  0.29041604  10.9286 &lt; 2.2e-16
log(no2)     0.39705423  0.04452880   8.9168 &lt; 2.2e-16
log(POPDEN) -0.05583014  0.01242876  -4.4920 7.055e-06
per_mixed    0.01851577  0.00579832   3.1933  0.001407
per_asian   -0.00228346  0.00045876  -4.9775 6.442e-07
per_black   -0.01263650  0.00100282 -12.6009 &lt; 2.2e-16
per_other   -0.00161419  0.00289082  -0.5584  0.576582

Rho: 0.66976, LR test value: 473.23, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.025311
    z-value: 26.461, p-value: &lt; 2.22e-16
Wald statistic: 700.19, p-value: &lt; 2.22e-16

Log likelihood: 196.7203 for lag model
ML residual variance (sigma squared): 0.035402, (sigma: 0.18815)
Number of observations: 983 
Number of parameters estimated: 9 
AIC: -375.44, (AIC for lm: 95.786)
LM test for residual autocorrelation
test value: 8.609, p-value: 0.0033451</code></pre>
</div>
</div>
<p><strong>ML SEM</strong></p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_1.sem</span> <span class="op">&lt;-</span> <span class="fu">errorsarlm</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">med_house_price</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">no2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">POPDEN</span><span class="op">)</span> <span class="op">+</span></span>
<span>                          <span class="va">per_mixed</span> <span class="op">+</span> <span class="va">per_asian</span> <span class="op">+</span> <span class="va">per_black</span> <span class="op">+</span> <span class="va">per_other</span>,  </span>
<span>                        data <span class="op">=</span> <span class="va">msoa.spdf</span>, </span>
<span>                        listw <span class="op">=</span> <span class="va">queens.lw</span>,</span>
<span>                        Durbin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># we could here extend to SDEM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_1.sem</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
errorsarlm(formula = log(med_house_price) ~ log(no2) + log(POPDEN) + 
    per_mixed + per_asian + per_black + per_other, data = msoa.spdf, 
    listw = queens.lw, Durbin = FALSE)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.581785 -0.105218 -0.012758  0.094430  0.913425 

Type: error 
Coefficients: (asymptotic standard errors) 
               Estimate  Std. Error  z value  Pr(&gt;|z|)
(Intercept) 12.92801104  0.35239139  36.6865 &lt; 2.2e-16
log(no2)     0.15735296  0.10880727   1.4462 0.1481317
log(POPDEN) -0.08316270  0.01254315  -6.6301 3.354e-11
per_mixed   -0.03377962  0.00811054  -4.1649 3.115e-05
per_asian   -0.00413115  0.00096849  -4.2656 1.994e-05
per_black   -0.01653816  0.00126741 -13.0488 &lt; 2.2e-16
per_other   -0.01693012  0.00462999  -3.6566 0.0002556

Lambda: 0.88605, LR test value: 623.55, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.015803
    z-value: 56.068, p-value: &lt; 2.22e-16
Wald statistic: 3143.6, p-value: &lt; 2.22e-16

Log likelihood: 271.8839 for error model
ML residual variance (sigma squared): 0.026911, (sigma: 0.16405)
Number of observations: 983 
Number of parameters estimated: 9 
AIC: NA (not available for weighted model), (AIC for lm: 95.786)</code></pre>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Anselin.1988" class="csl-entry" role="listitem">
Anselin, Luc. 1988. <em>Spatial <span>Econometrics</span>: <span>Methods</span> and <span>Models</span></em>. Studies in <span>Operational Regional Science</span>. <span>Dordrecht</span>: <span>Kluwer</span>.
</div>
<div id="ref-Anselin.1998" class="csl-entry" role="listitem">
Anselin, Luc, and Anil K. Bera. 1998. <span>“Spatial <span>Dependence</span> in <span>Linear Regression Models</span> with an <span>Introduction</span> to <span>Spatial Econometrics</span>.”</span> In <em>Handbook of <span>Applied Economic Statistics</span></em>, edited by Aman Ullah and David E. A. Giles, 237–89. <span>New York</span>: <span>Dekker</span>.
</div>
<div id="ref-Betz.2020" class="csl-entry" role="listitem">
Betz, Timm, Scott J. Cook, and Florian M. Hollenbach. 2020. <span>“Spatial Interdependence and Instrumental Variable Models.”</span> <em>Political Science Research and Methods</em> 8 (4): 646–61. <a href="https://doi.org/10.1017/psrm.2018.61">https://doi.org/10.1017/psrm.2018.61</a>.
</div>
<div id="ref-Bivand.2021" class="csl-entry" role="listitem">
Bivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. <span>“A <span>Review</span> of <span>Software</span> for <span>Spatial Econometrics</span> in <span>R</span>.”</span> <em>Mathematics</em> 9 (11): 1276. <a href="https://doi.org/10.3390/math9111276">https://doi.org/10.3390/math9111276</a>.
</div>
<div id="ref-Cook.2020" class="csl-entry" role="listitem">
Cook, Scott J., Jude C. Hays, and Robert J. Franzese. 2020. <span>“Model <span>Specification</span> and <span>Spatial Interdependence</span>.”</span> In <em>The <span>Sage</span> Handbook of Research Methods in Political Science and International Relations</em>, edited by Luigi Curini and Robert Franzese, 1st ed, 730–47. <span>Thousand Oaks</span>: <span>SAGE Inc</span>.
</div>
<div id="ref-Drukker.2013" class="csl-entry" role="listitem">
Drukker, David M., Peter Egger, and Ingmar R. Prucha. 2013. <span>“On <span>Two-Step Estimation</span> of a <span>Spatial Autoregressive Model</span> with <span>Autoregressive Disturbances</span> and <span>Endogenous Regressors</span>.”</span> <em>Econometric Reviews</em> 32 (5-6): 686–733. <a href="https://doi.org/10.1080/07474938.2013.741020">https://doi.org/10.1080/07474938.2013.741020</a>.
</div>
<div id="ref-Franzese.2007" class="csl-entry" role="listitem">
Franzese, Robert J., and Jude C. Hays. 2007. <span>“Spatial <span>Econometric Models</span> of <span>Cross-Sectional Interdependence</span> in <span>Political Science Panel</span> and <span>Time-Series-Cross-Section Data</span>.”</span> <em>Political Analysis</em> 15 (2): 140–64. <a href="https://doi.org/10.1093/pan/mpm005">https://doi.org/10.1093/pan/mpm005</a>.
</div>
<div id="ref-Gibbons.2012" class="csl-entry" role="listitem">
Gibbons, Steve, and Henry G. Overman. 2012. <span>“Mostly <span>Pointless Spatial Econometrics</span>?”</span> <em>Journal of Regional Science</em> 52 (2): 172–91. <a href="https://doi.org/10.1111/j.1467-9787.2012.00760.x">https://doi.org/10.1111/j.1467-9787.2012.00760.x</a>.
</div>
<div id="ref-HalleckVega.2015" class="csl-entry" role="listitem">
Halleck Vega, Solmaria, and J. Paul Elhorst. 2015. <span>“The <span>SLX Model</span>.”</span> <em>Journal of Regional Science</em> 55 (3): 339–63. <a href="https://doi.org/10.1111/jors.12188">https://doi.org/10.1111/jors.12188</a>.
</div>
<div id="ref-Kelejian.2017" class="csl-entry" role="listitem">
Kelejian, Harry H., and Gianfranco Piras. 2017. <em>Spatial <span>Econometrics</span></em>. <span>Elsevier</span>. <a href="https://doi.org/10.1016/C2016-0-04332-2">https://doi.org/10.1016/C2016-0-04332-2</a>.
</div>
<div id="ref-Kelejian.1998" class="csl-entry" role="listitem">
Kelejian, Harry H., and Ingmar R. Prucha. 1998. <span>“A <span>Generalized Spatial Two-Stage Least Squares Procedure</span> for <span>Estimating</span> a <span>Spatial Autoregressive Model</span> with <span>Autoregressive Disturbances</span>.”</span> <em>The Journal of Real Estate Finance and Economics</em> 17 (1): 99–121. <a href="https://doi.org/10.1023/A:1007707430416">https://doi.org/10.1023/A:1007707430416</a>.
</div>
<div id="ref-Kelejian.2010" class="csl-entry" role="listitem">
———. 2010. <span>“Specification and <span>Estimation</span> of <span>Spatial Autoregressive Models</span> with <span>Autoregressive</span> and <span>Heteroskedastic Disturbances</span>.”</span> <em>Journal of Econometrics</em> 157 (1): 53–67. <a href="https://doi.org/10.1016/j.jeconom.2009.10.025">https://doi.org/10.1016/j.jeconom.2009.10.025</a>.
</div>
<div id="ref-Kelejian.2004" class="csl-entry" role="listitem">
Kelejian, Harry H., Ingmar R. Prucha, and Yevgeny Yuzefovich. 2004. <span>“Instrumental <span>Variable Estimation</span> of a <span>Spatial Autoregressive Model</span> with <span>Autoregressive Disturbances</span>: <span>Large</span> and <span>Small Sample Results</span>.”</span> In <em>Spatial and <span>Spatiotemporal Econometrics</span></em>, edited by James P. LeSage and R. Kelley Pace, 163–98. Advances in <span>Econometrics</span>. <span>Amsterdam and Boston</span>: <span>Elsevier</span>.
</div>
<div id="ref-Lee.2004" class="csl-entry" role="listitem">
Lee, Lung-fei. 2004. <span>“Asymptotic <span>Distributions</span> of <span>Quasi-Maximum Likelihood Estimators</span> for <span>Spatial Autoregressive Models</span>.”</span> <em>Econometrica</em> 72 (6): 1899–1925.
</div>
<div id="ref-LeSage.2014" class="csl-entry" role="listitem">
LeSage, James P. 2014. <span>“What <span>Regional Scientists Need</span> to <span>Know</span> about <span>Spatial Econometrics</span>.”</span> <em>The Review of Regional Studies</em> 44 (1): 13–32. https://doi.org/<a href="https://dx.doi.org/10.2139/ssrn.2420725">https://dx.doi.org/10.2139/ssrn.2420725</a>.
</div>
<div id="ref-LeSage.2009" class="csl-entry" role="listitem">
LeSage, James P., and R. Kelley Pace. 2009. <em>Introduction to <span>Spatial Econometrics</span></em>. Statistics, <span>Textbooks</span> and <span>Monographs</span>. <span>Boca Raton</span>: <span>CRC Press</span>.
</div>
<div id="ref-Ord.1975" class="csl-entry" role="listitem">
Ord, John Keith. 1975. <span>“Estimation <span>Methods</span> for <span>Models</span> of <span>Spatial Interaction</span>.”</span> <em>Journal of the American Statistical Association</em> 70 (349): 120–26. <a href="https://doi.org/10.2307/2285387">https://doi.org/10.2307/2285387</a>.
</div>
<div id="ref-Pace.2010" class="csl-entry" role="listitem">
Pace, R. Kelley, and James P. LeSage. 2010. <span>“Omitted <span>Variable Biases</span> of <span>OLS</span> and <span>Spatial Lag Models</span>.”</span> In <em>Progress in <span>Spatial Analysis</span></em>, edited by Antonio Páez, Julie Gallo, Ron N. Buliung, and Sandy Dall’erba, 17–28. <span>Berlin and Heidelberg</span>: <span>Springer</span>.
</div>
<div id="ref-Pebesma.2023" class="csl-entry" role="listitem">
Pebesma, Edzer, and Roger Bivand. 2023. <em>Spatial <span>Data Science</span>: <span>With Applications</span> in <span>R</span></em>. First. <span>Boca Raton</span>: <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9780429459016">https://doi.org/10.1201/9780429459016</a>.
</div>
<div id="ref-Ruttenauer.2022a" class="csl-entry" role="listitem">
Rüttenauer, Tobias. 2022. <span>“Spatial <span>Regression Models</span>: <span>A Systematic Comparison</span> of <span>Different Model Specifications Using Monte Carlo Experiments</span>.”</span> <em>Sociological Methods &amp; Research</em> 51 (2): 728–59. <a href="https://doi.org/10.1177/0049124119882467">https://doi.org/10.1177/0049124119882467</a>.
</div>
<div id="ref-Sarrias.2023" class="csl-entry" role="listitem">
Sarrias, Mauricio. 2023. <em>Intermediate <span>Spatial Econometrics</span> with <span>Applications</span> in <span>R</span></em>.
</div>
<div id="ref-Wimpy.2021" class="csl-entry" role="listitem">
Wimpy, Cameron, Guy D. Whitten, and Laron K. Williams. 2021. <span>“X <span>Marks</span> the <span>Spot</span>: <span>Unlocking</span> the <span>Treasure</span> of <span>Spatial-X Models</span>.”</span> <em>The Journal of Politics</em> 83 (2): 722–39. <a href="https://doi.org/10.1086/710089">https://doi.org/10.1086/710089</a>.
</div>
<div id="ref-Wooldridge.2010" class="csl-entry" role="listitem">
Wooldridge, Jeffrey M. 2010. <em>Econometric <span>Analysis</span> of <span>Cross Section</span> and <span>Panel Data</span></em>. <span>Cambridge, Mass.</span>: <span>MIT Press</span>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04_exercise1_short.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exercise I</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07_impacts_short.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spatial Impacts</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb47" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>\newcommand{\Exp}{\mathrm{E}}</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>\newcommand\given<span class="co">[</span><span class="ot">1</span><span class="co">][]</span>{\:#1\vert\:}</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>\newcommand{\Cov}{\mathrm{Cov}}</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>\newcommand{\Var}{\mathrm{Var}}</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>\newcommand{\rank}{\mathrm{rank}}</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>\newcommand{\bm}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\boldsymbol{\mathbf{#1}}}</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>\newcommand{\tr}{\mathrm{tr}}</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>\newcommand{\plim}{\operatornamewithlimits{plim}}</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>\newcommand{\diag}{\mathrm{diag}}</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># Spatial Regression Models</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required packages {.unnumbered}</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE, results = 'hide'}</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sf"</span>, <span class="st">"mapview"</span>, <span class="st">"spdep"</span>, <span class="st">"spatialreg"</span>, <span class="st">"tmap"</span>, <span class="st">"viridisLite"</span>) <span class="co"># note: load spdep first, then spatialreg</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="fu">### Session info {.unnumbered}</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reload data from pervious session {.unnumbered}</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"_data/msoa2_spatial.RData"</span>)</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>There are various techniques to model spatial dependence and spatial processes <span class="co">[</span><span class="ot">@LeSage.2009</span><span class="co">]</span>. Here, we will just cover a few of the most common techniques / econometric models. One advantage of the most basic spatial model (SLX) is that this method can easily be incorporated in a variety of other methodologies, such as machine learning approaches.</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>For more in-depth materials see @LeSage.2009 and @Kelejian.2017. @Franzese.2007, @HalleckVega.2015, @LeSage.2014, @Ruttenauer.2022a, and @Wimpy.2021 provide article-length introductions.</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why do we need spatial regression models</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non-spatial OLS</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>Let us start with a linear model, where $\bm y$ is the outcome or dependent variable ($N \times 1$), $\bm X$ are various exogenous covariates ($N \times k$), and $\bm \varepsilon$ ($N \times 1$) is the error term. We are usually interested in the coefficient vector $\bm \beta$ ($k \times 1$) and its insecurity estimates.</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>{\bm y}={\bm X}{\bm \beta}+ {\bm \varepsilon}</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>The work-horse for estimating $\bm \beta$ in the social science is the OLS estimator <span class="co">[</span><span class="ot">@Wooldridge.2010</span><span class="co">]</span>.</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>\hat{\beta}=({\bm X}^\intercal{\bm X})^{-1}{\bm X}^\intercal{\bm y}.</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a><span class="fu">### OLS assumptions I</span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>$\Exp(\epsilon_i|\bm X_i) = 0$: for every value of $X$, the average / expectation of the error term $\bm \varepsilon$ equals zero -- put differently: the error term is independent of $X$,</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>the observations of the sample are independent and identically distributed (i.i.d),</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>the fourth moments of the variables $\bm X_i$ and $Y_i$ are positive and definite -- put differently: extreme values / outliers are very very rare,</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>$\text{rank}(\bm X) = K$: the matrix $\bm X$ has full rank -- put differently: no perfect multicollinearity between the covariates,</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a><span class="fu">### OLS assumptions II</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>$\Var(\varepsilon|x) = \sigma^2$: the error terms $\varepsilon$ are homoskedastic / have the same variance given any value of the explanatory variable, </span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>$\varepsilon \sim \mathcal{N}(0, \sigma^2)$: the error terms $\varepsilon$ are normally distributed (conditional on the explanatory variables $X_i$).</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>Which of the six assumptions above may be violated by spatial dependence?</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/assumptions.jpg)</span></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Problem of ignoring spatial dependence</span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>Does spatial dependence influence the results / coefficient estimates of non-spatial regression models, or in other words: is ignoring spatial dependence harmful?</span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>I've heard different answers, ranging from "It only affects the standard errors" to "it always introduces bias". As so often, the true (or best?) answer is somewhere in the middle: *it depends* <span class="co">[</span><span class="ot">@Betz.2020; @Cook.2020; @Pace.2010; @Ruttenauer.2022a</span><span class="co">]</span>.</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>The easiest way to think of it is analogous to the omit variable bias <span class="co">[</span><span class="ot">@Betz.2020; @Cook.2020</span><span class="co">]</span>:</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>plim~\hat{\beta}_{OLS}= \beta  + \gamma \frac{\Cov(\bm x, \bm z)}{\Var(\bm x)},</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>where $z$ is some omit variable, and $\gamma$ is the conditional effect of $\bm z$ on $\bm y$. Now imagine that the neighbouring values of the dependent variable $\bm W \bm y$ are autocorrelated to focal unit which we denote with $\rho &gt; 0$, and that the covariance between the focal unit's exogenous covariates and $\bm W \bm y$ is not zero. Then we will have an omitted variable bias due to spatial dependence:</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a>plim~\hat{\beta}_{OLS}= \beta  + \rho \frac{\Cov(\bm x, \bm W \bm y)}{\Var(\bm x)} \neq \beta,</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>For completeness, the entire bias is a bit more complicated <span class="co">[</span><span class="ot">@Pace.2010; @Ruttenauer.2022a</span><span class="co">]</span> and looks like:</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>plim~\hat{\beta}=\frac{\sum_{ij}({\bm M}(\delta){\bm M}(\delta)^\intercal\circ{\bm M}(\rho))_{ij}}</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>{\tr({\bm M}(\delta){\bm M}(\delta)^\intercal)}\beta <span class="sc">\\</span></span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>+\frac{\sum_{ij}({\bm M}(\delta){\bm M}(\delta)^\intercal\circ{\bm M}(\rho){\bm W})_{ij}}</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>{\tr({\bm M}(\delta){\bm M}(\delta)^\intercal)}\theta,</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>where $\circ$ denotes the Hadamard product, ${\bm M}(\delta)=({\bm I}_N-\delta{\bm W})^{-1}$, and ${\bm M}(\rho)=({\bm I}_N-\rho{\bm W})^{-1}$.</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;&lt;center&gt;</span>*(Don't worry, no need to learn by hard!!)*<span class="kw">&lt;/center&gt;&lt;/p&gt;</span></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>Essentially, the non-spatial OLS estimator $\beta_{OLS}$ is biased in the presence of either <span class="co">[</span><span class="ot">@Pace.2010; @Ruttenauer.2022a</span><span class="co">]</span>:</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Spatial autocorrelation in the dependent variable ($\rho\neq0$) and spatial autocorrelation in the covariate ($\delta\neq0$). This bias increases with $\rho$, $\delta$, and $\beta$.</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Local spatial spillover effects ($\theta\neq0$) and spatial autocorrelation in the covariate ($\delta\neq0$). This is analogous to the omitted variable bias resulting from the omission of ${\bm W} {\bm x}$. It increases with $\theta$ and $\delta$, but additionally with $\rho$ if $\theta\neq0$ and $\delta\neq0$.</span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An omitted variable and $\mathrm{E}({\bm \varepsilon}|{\bm x})\neq0$. This non-spatial omitted variable bias $\gamma$ is amplified by spatial dependence in the disturbances ($\lambda$) and spatial autocorrelation in the dependent variable ($\rho$), but also increases with positive values of $\delta$ if either $\rho\neq 0$ or $\lambda\neq 0$. Obviously, it also increases with $\gamma$.</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial Regression Models</span></span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a>Broadly, spatial dependence or clustering in some characteristic can be the result of three different processes:</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>  id1{Spatial dependence} --&gt; A[Spatial interdepence]</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a>  id1 --&gt; B[Spillovers from covariates]</span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a>  id1 --&gt; C[Clustering unobservables]</span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>Strictly speaking, there are some other possibilities too, such as measurement error or the wrong choice on the spatial level. For instance, imagine we have a city-specific characteristic (e.g. public spending) allocated to neighbourhood units. Obviously, this will introduce heavy autocorrelation on the neigbourhood level by construction.</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a>There are three basic ways of incorporating spatial dependence, which then can be further combined. As before, the $N \times N$ spatial weights matrix $\bm W$ defines the spatial relationship between units.</span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Error Model (SEM)</span></span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clustering on Unobservables</span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a>        \begin{equation} </span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a>        \begin{split}</span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a>        {\bm y}&amp;=\alpha{\bm \iota}+{\bm X}{\bm \beta}+{\bm u},<span class="sc">\\</span></span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>        {\bm u}&amp;=\lambda{\bm W}{\bm u}+{\bm \varepsilon}</span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a>        \end{split} </span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a>$$      </span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a>$\lambda$ denotes the strength of the spatial correlation in the errors of the model: *your errors influence my errors*. </span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$&gt; 0$: positive error dependence,</span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$&lt; 0$: negative error dependence,</span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$= 0$: traditional OLS model.</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a>$\lambda$ is defined in the range $<span class="co">[</span><span class="ot">-1, +1</span><span class="co">]</span>$.</span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Autoregressive Model (SAR)</span></span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interdependence</span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a>    \begin{equation} </span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a>        {\bm y}=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+ {\bm \varepsilon}</span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a>        \end{equation}  </span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a>$$  </span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a>$\rho$ denotes the strength of the spatial correlation in the dependent variable (spatial autocorrelation): *your outcome influences my outcome*. </span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$&gt; 0$: positive spatial dependence,</span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$&lt; 0$: negative spatial dependence,</span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$= 0$: traditional OLS model.</span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a>$\rho$ is defined in the range $<span class="co">[</span><span class="ot">-1, +1</span><span class="co">]</span>$.</span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatially lagged X Model (SLX)</span></span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Spillovers in Covariates</span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a>        \begin{equation}</span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a>        {\bm y}=\alpha{\bm \iota}+{\bm X}{\bm \beta}+{\bm W}{\bm X}{\bm \theta}+ {\bm \varepsilon}</span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a>$$  </span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a>$\theta$ denotes the strength of the spatial spillover effects from covariate(s) on the dependent variable: *your covariates influence my outcome*. </span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a>$\theta$ is basically like any other coefficient from a covariate. It is thus not bound to any range.</span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a>Moreover, there are models combining two sets of the above specifications.</span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Durbin Model (SDM)</span></span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interdependence</span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Spillovers in Covariates</span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a>        \begin{equation}</span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a>        {\bm y}=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+{\bm W}{\bm X}{\bm \theta}+ {\bm \varepsilon}</span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a>$$  </span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Durbin Error Model (SDEM)</span></span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clustering on Unobservables</span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Spillovers in Covariates</span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a>    \begin{equation}</span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a>        \begin{split}</span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a>        {\bm y}&amp;=\alpha{\bm \iota}+{\bm X}{\bm \beta}+{\bm W}{\bm X}{\bm \theta}+ {\bm u},<span class="sc">\\</span></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a>        {\bm u}&amp;=\lambda{\bm W}{\bm u}+{\bm \varepsilon}</span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a>        \end{split}</span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combined Spatial Autocorrelation Model (SAC)</span></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clustering on Unobservables</span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interdependence</span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a>        \begin{equation}</span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a>        \begin{split}</span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a>        {\bm y}&amp;=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+ {\bm u},<span class="sc">\\</span></span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a>        {\bm u}&amp;=\lambda{\bm W}{\bm u}+{\bm \varepsilon}</span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a>        \end{split}</span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a><span class="fu">### General Nesting Spatial Model (GNS)</span></span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Clustering on Unobservables</span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Interdependence</span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Spillovers in Covariates</span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a>        \begin{equation}</span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a>        \begin{split}</span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a>        {\bm y}&amp;=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+{\bm W}{\bm X}{\bm \theta}+ {\bm u},<span class="sc">\\</span></span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a>        {\bm u}&amp;=\lambda{\bm W}{\bm u}+{\bm \varepsilon}</span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a>        \end{split}</span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a>        \end{equation}</span>
<span id="cb47-256"><a href="#cb47-256" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Manski's reflection problem</span></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a>The General Nesting Spatial Model (GNS) is only weakly (or not?) identifiable <span class="co">[</span><span class="ot">@Gibbons.2012</span><span class="co">]</span>. </span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a>It's analogous to Manski's reflection problem on neighbourhood effects \citep{Manski.1993.0}: If people in the same group behave similar, this can be because a) imitating behaviour of the group, b) exogenous characteristics of the group influence the behaviour, and c) members of the same group are exposed to the same external circumstances. *We just cannot separate those in observational data.*</span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a>Note that all of these models assume different data generating processes (DGP) leading to the spatial pattern. Although there are specifications tests, it is generally not possible to let the data decide which one is the true underlying DGP <span class="co">[</span><span class="ot">@Cook.2020; @Ruttenauer.2022a</span><span class="co">]</span>. However, there might be theoretical reasons to guide the model specification <span class="co">[</span><span class="ot">@Cook.2020</span><span class="co">]</span>. </span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a>Just because SAR is probably the most commonly used model does not make it the best choice. In contrast, various studies <span class="co">[</span><span class="ot">@HalleckVega.2015; @Ruttenauer.2022a; @Wimpy.2021</span><span class="co">]</span> highlight the advantages of the relative simple SLX model. Moreover, this specification can basically be incorporated in any other statistical method.</span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### A note on missings</span></span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a>Missing values create a problem in spatial data analysis. For instance, in a local spillover model with an average of 10 neighbours, two initial missing values will lead to 20 missing values in the spatially lagged variable. For global spillover models, one initial missing will 'flow' through the neighbourhood system until the cutoff point (and create an excess amount of missings). </span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a>Depending on the data, units with missings can either be dropped and omitted from the initial weights creation, or we need to impute the data first, e.g. using interpolation or Kriging.</span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mini Example</span></span>
<span id="cb47-278"><a href="#cb47-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-279"><a href="#cb47-279" aria-hidden="true" tabindex="-1"></a>Let's try to make sense of this. We rely on a mini example using a few units in Camden</span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-283"><a href="#cb47-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-284"><a href="#cb47-284" aria-hidden="true" tabindex="-1"></a>sub.spdf <span class="ot">&lt;-</span> msoa.spdf[<span class="fu">c</span>(<span class="dv">172</span>, <span class="dv">175</span>, <span class="dv">178</span>, <span class="dv">179</span>, <span class="dv">181</span>, <span class="dv">182</span>), ]</span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(sub.spdf)</span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a>We then construct queens neighbours, and have a look at the resulting non-normalized matrix $\bm W$.</span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a>queens.nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(sub.spdf, <span class="at">queen =</span> <span class="cn">TRUE</span>, <span class="at">snap =</span> <span class="dv">1</span>)</span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">nb2mat</span>(queens.nb, <span class="at">style =</span> <span class="st">"B"</span>)</span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a>W</span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a>We have selected 6 units. So, $\bm W$ is a $6 \times 6$ matrix. we see that observation 1 has one neighbour: observation 3. Observation 2 has two neighbours: observation 4 and observation 6. The diagonal is zero: no unit is a neighbour of themselves.</span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a>No we row-normalize this matrix.</span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-303"><a href="#cb47-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-304"><a href="#cb47-304" aria-hidden="true" tabindex="-1"></a>queens.lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(queens.nb,</span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a>W_rn <span class="ot">&lt;-</span> <span class="fu">listw2mat</span>(queens.lw)</span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a>W_rn</span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a>No every single weight $w_{ij}$ is divided by the total number of neighbours $n_i$ of the focal unit. For observation 1, observation 3 is the only neighbour, thus a weight = 1. For observation two, both neighbours have a weight of 1/2. For observation 3 (with three neighbours) each neighbour got a weight of 1/3.</span>
<span id="cb47-311"><a href="#cb47-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-312"><a href="#cb47-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a><span class="fu">## Question</span></span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a>What happens if we multiply this matrix $\bm W$ with a $N \times 1$ vector $\bm y$ or $\bm x$?</span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a>A short reminder on matrix multiplication. </span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a>\bm W * \bm y =</span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a>w_{11} &amp; w_{12} &amp; w_{13}<span class="sc">\\</span></span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a>w_{21} &amp; w_{22} &amp; w_{23}<span class="sc">\\</span></span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a>w_{31} &amp; w_{32} &amp; w_{33} </span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} *</span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a>y_{11} <span class="sc">\\</span></span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a>y_{21} <span class="sc">\\</span></span>
<span id="cb47-331"><a href="#cb47-331" aria-hidden="true" tabindex="-1"></a>y_{31}  </span>
<span id="cb47-332"><a href="#cb47-332" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}<span class="sc">\\</span></span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a>= \begin{bmatrix}</span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a>w_{11}y_{11} + w_{12}y_{21} + w_{13}y_{31}<span class="sc">\\</span></span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a>w_{21}y_{11} + w_{22}y_{21} + w_{23}y_{31}<span class="sc">\\</span></span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a>w_{31}y_{11} + w_{32}y_{21} + w_{33}y_{31}  </span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a>Each line of $\bm W * \bm y$ just gives a weighted average of the other $y$-values $y_j$ in the sample. In case of the row-normalization, each neighbour gets the same weight $\frac{1}{n_i}$. This is simply the mean of $y_j$ of the neighbours in case of a row-normalized contiguity weights matrix.</span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-342"><a href="#cb47-342" aria-hidden="true" tabindex="-1"></a>Note that the *mean* interpretation is only valid with row-normalization. What would we get with inverse-distance based weights?</span>
<span id="cb47-343"><a href="#cb47-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a>Let's look at this in our example</span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sub.spdf<span class="sc">$</span>med_house_price</span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> sub.spdf<span class="sc">$</span>pubs_count</span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a>W_rn</span>
<span id="cb47-352"><a href="#cb47-352" aria-hidden="true" tabindex="-1"></a>y</span>
<span id="cb47-353"><a href="#cb47-353" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a>W_rn_y <span class="ot">&lt;-</span> W_rn <span class="sc">%*%</span> y</span>
<span id="cb47-356"><a href="#cb47-356" aria-hidden="true" tabindex="-1"></a>W_rn_x <span class="ot">&lt;-</span> W_rn <span class="sc">%*%</span> x</span>
<span id="cb47-357"><a href="#cb47-357" aria-hidden="true" tabindex="-1"></a>W_rn_y</span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a>W_rn_x</span>
<span id="cb47-359"><a href="#cb47-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-360"><a href="#cb47-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-361"><a href="#cb47-361" aria-hidden="true" tabindex="-1"></a>Let's check if our interpretation is true</span>
<span id="cb47-362"><a href="#cb47-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-365"><a href="#cb47-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-366"><a href="#cb47-366" aria-hidden="true" tabindex="-1"></a>W_rn_y[<span class="dv">1</span>] <span class="sc">==</span> y[<span class="dv">3</span>]</span>
<span id="cb47-367"><a href="#cb47-367" aria-hidden="true" tabindex="-1"></a>W_rn_y[<span class="dv">2</span>] <span class="sc">==</span> <span class="fu">mean</span>(y[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>)])</span>
<span id="cb47-368"><a href="#cb47-368" aria-hidden="true" tabindex="-1"></a>W_rn_y[<span class="dv">4</span>] <span class="sc">==</span> <span class="fu">mean</span>(y[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>)])</span>
<span id="cb47-369"><a href="#cb47-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-370"><a href="#cb47-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-371"><a href="#cb47-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-372"><a href="#cb47-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-373"><a href="#cb47-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-374"><a href="#cb47-374" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real Example</span></span>
<span id="cb47-375"><a href="#cb47-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-376"><a href="#cb47-376" aria-hidden="true" tabindex="-1"></a>First, we need the a spatial weights matrix.</span>
<span id="cb47-377"><a href="#cb47-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-380"><a href="#cb47-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-381"><a href="#cb47-381" aria-hidden="true" tabindex="-1"></a><span class="co"># Contiguity (Queens) neighbours weights</span></span>
<span id="cb47-382"><a href="#cb47-382" aria-hidden="true" tabindex="-1"></a>queens.nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(msoa.spdf, </span>
<span id="cb47-383"><a href="#cb47-383" aria-hidden="true" tabindex="-1"></a>                     <span class="at">queen =</span> <span class="cn">TRUE</span>, </span>
<span id="cb47-384"><a href="#cb47-384" aria-hidden="true" tabindex="-1"></a>                     <span class="at">snap =</span> <span class="dv">1</span>) <span class="co"># we consider points in 1m distance as 'touching'</span></span>
<span id="cb47-385"><a href="#cb47-385" aria-hidden="true" tabindex="-1"></a>queens.lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(queens.nb,</span>
<span id="cb47-386"><a href="#cb47-386" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb47-387"><a href="#cb47-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-388"><a href="#cb47-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-389"><a href="#cb47-389" aria-hidden="true" tabindex="-1"></a>We can estimate spatial models using <span class="in">`spatialreg`</span>. </span>
<span id="cb47-390"><a href="#cb47-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-391"><a href="#cb47-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### SAR</span></span>
<span id="cb47-392"><a href="#cb47-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-393"><a href="#cb47-393" aria-hidden="true" tabindex="-1"></a>Lets estimate a spatial SAR model using the <span class="in">`lagsarlm()`</span> with contiguity weights. We use median house value as depended variable, and include population density (<span class="in">`POPDEN`</span>), the air pollution (<span class="in">`no2`</span>), and the share of ethnic minorities (<span class="in">`per_mixed`</span>, <span class="in">`per_asian`</span>, <span class="in">`per_black`</span>,  <span class="in">`per_other`</span>).</span>
<span id="cb47-394"><a href="#cb47-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-397"><a href="#cb47-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-398"><a href="#cb47-398" aria-hidden="true" tabindex="-1"></a>mod_1.sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-399"><a href="#cb47-399" aria-hidden="true" tabindex="-1"></a>                        per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-400"><a href="#cb47-400" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-401"><a href="#cb47-401" aria-hidden="true" tabindex="-1"></a>                      <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-402"><a href="#cb47-402" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Durbin =</span> <span class="cn">FALSE</span>) <span class="co"># we could here extend to SDM</span></span>
<span id="cb47-403"><a href="#cb47-403" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sar)</span>
<span id="cb47-404"><a href="#cb47-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-405"><a href="#cb47-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-406"><a href="#cb47-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-407"><a href="#cb47-407" aria-hidden="true" tabindex="-1"></a>This looks pretty much like a conventional model output, with some additional information: a highly significant <span class="in">`mod_1.sar$rho`</span> of <span class="in">`r round(mod_1.sar$rho, 2)`</span> indicates strong positive spatial autocorrelation. </span>
<span id="cb47-408"><a href="#cb47-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-409"><a href="#cb47-409" aria-hidden="true" tabindex="-1"></a>Remember that is the coefficient for the term $\bm y = \rho \bm W \bm y \ldots$. It is bound to be below 1 for positive autocorrelation.</span>
<span id="cb47-410"><a href="#cb47-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-411"><a href="#cb47-411" aria-hidden="true" tabindex="-1"></a>In substantive terms, house prices in the focal unit positively influence house prices in neighbouring units, which again influences house prices among the neighbours of these neighbours, and so on (we'll get back to this).</span>
<span id="cb47-412"><a href="#cb47-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-413"><a href="#cb47-413" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb47-414"><a href="#cb47-414" aria-hidden="true" tabindex="-1"></a>The coefficients of covariates in a SAR model are not marginal or partial effects, because of the spillovers and feedback loops in $\bm y$ (see below)!</span>
<span id="cb47-415"><a href="#cb47-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-416"><a href="#cb47-416" aria-hidden="true" tabindex="-1"></a>From the coefficient, we can only interpret the direction: there's a positive effect of air pollution and a negative effect of population sensitivity, and so on...</span>
<span id="cb47-417"><a href="#cb47-417" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-418"><a href="#cb47-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-419"><a href="#cb47-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-420"><a href="#cb47-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-421"><a href="#cb47-421" aria-hidden="true" tabindex="-1"></a><span class="fu">### SEM</span></span>
<span id="cb47-422"><a href="#cb47-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-423"><a href="#cb47-423" aria-hidden="true" tabindex="-1"></a>SEM models can be estimated using <span class="in">`errorsarlm()`</span>.</span>
<span id="cb47-424"><a href="#cb47-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-427"><a href="#cb47-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-428"><a href="#cb47-428" aria-hidden="true" tabindex="-1"></a>mod_1.sem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span></span>
<span id="cb47-429"><a href="#cb47-429" aria-hidden="true" tabindex="-1"></a>                          per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-430"><a href="#cb47-430" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-431"><a href="#cb47-431" aria-hidden="true" tabindex="-1"></a>                        <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-432"><a href="#cb47-432" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Durbin =</span> <span class="cn">FALSE</span>) <span class="co"># we could here extend to SDEM</span></span>
<span id="cb47-433"><a href="#cb47-433" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sem)</span>
<span id="cb47-434"><a href="#cb47-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-435"><a href="#cb47-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-436"><a href="#cb47-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-437"><a href="#cb47-437" aria-hidden="true" tabindex="-1"></a>In this case <span class="in">`mod_1.sem$lambda`</span> gives us the spatial parameter. A highly significant lambda of <span class="in">`r round(mod_1.sem$lambda, 2)`</span> indicates that the errors are highly spatially correlated (e.g. due to correlated unobservables). Again, $\lambda = 1 $ would be the maximum.</span>
<span id="cb47-438"><a href="#cb47-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-439"><a href="#cb47-439" aria-hidden="true" tabindex="-1"></a>In spatial error models, we can interpret the coefficients directly, as in a conventional linear model. </span>
<span id="cb47-440"><a href="#cb47-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-441"><a href="#cb47-441" aria-hidden="true" tabindex="-1"></a><span class="fu">### SLX</span></span>
<span id="cb47-442"><a href="#cb47-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-443"><a href="#cb47-443" aria-hidden="true" tabindex="-1"></a>SLX models can either be estimated with <span class="in">`lmSLX()`</span> directly, or by creating $\bm W \bm X$ manually and plugging it into any available model-fitting function.</span>
<span id="cb47-444"><a href="#cb47-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-447"><a href="#cb47-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-448"><a href="#cb47-448" aria-hidden="true" tabindex="-1"></a>mod_1.slx <span class="ot">&lt;-</span> <span class="fu">lmSLX</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-449"><a href="#cb47-449" aria-hidden="true" tabindex="-1"></a>                     per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-450"><a href="#cb47-450" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-451"><a href="#cb47-451" aria-hidden="true" tabindex="-1"></a>                   <span class="at">listw =</span> queens.lw, </span>
<span id="cb47-452"><a href="#cb47-452" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Durbin =</span> <span class="cn">TRUE</span>) <span class="co"># use a formula to lag only specific covariates</span></span>
<span id="cb47-453"><a href="#cb47-453" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.slx)</span>
<span id="cb47-454"><a href="#cb47-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-455"><a href="#cb47-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-456"><a href="#cb47-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-457"><a href="#cb47-457" aria-hidden="true" tabindex="-1"></a>In SLX models, we can simply interpret the coefficients of direct and indirect (spatially lagged) covariates. </span>
<span id="cb47-458"><a href="#cb47-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-459"><a href="#cb47-459" aria-hidden="true" tabindex="-1"></a>For instance, lets look at population density: </span>
<span id="cb47-460"><a href="#cb47-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-461"><a href="#cb47-461" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb47-462"><a href="#cb47-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpretaion SLX</span></span>
<span id="cb47-463"><a href="#cb47-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-464"><a href="#cb47-464" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A high population density in the focal unit is related to lower house prices (a 1% increase in population density decreses house prices by <span class="in">`r round(unname(mod_1.slx$coefficients["log.POPDEN."]), 2)`</span>%), but </span>
<span id="cb47-465"><a href="#cb47-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-466"><a href="#cb47-466" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A high population density in the neighbouring areas is related to higher house prices (while keeping population density in the focal unit constant). A 1% increase in the *average* population density *across the adjacent neighbourhoods* increases house prices in *the focal unit* by <span class="in">`r round(unname(mod_1.slx$coefficients["lag.log.POPDEN."]), 2)`</span>%) </span>
<span id="cb47-467"><a href="#cb47-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-468"><a href="#cb47-468" aria-hidden="true" tabindex="-1"></a>Potential interpretation: areas with a low population density in central regions of the city (high pop density in surrounding neighbourhoods) have higher house prices. We could try testing this interpretation by including the distance to the city center as a control.</span>
<span id="cb47-469"><a href="#cb47-469" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-470"><a href="#cb47-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-471"><a href="#cb47-471" aria-hidden="true" tabindex="-1"></a>Also note how the air pollution coefficient has changed here, with a negative effect in the focal unit and positive one amonf the neighbouring units.</span>
<span id="cb47-472"><a href="#cb47-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-473"><a href="#cb47-473" aria-hidden="true" tabindex="-1"></a>An alternative way of estimating the same model is lagging the covariates first.</span>
<span id="cb47-474"><a href="#cb47-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-477"><a href="#cb47-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-478"><a href="#cb47-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through vars and create lagged variables</span></span>
<span id="cb47-479"><a href="#cb47-479" aria-hidden="true" tabindex="-1"></a>msoa.spdf<span class="sc">$</span>log_POPDEN <span class="ot">&lt;-</span> <span class="fu">log</span>(msoa.spdf<span class="sc">$</span>POPDEN)</span>
<span id="cb47-480"><a href="#cb47-480" aria-hidden="true" tabindex="-1"></a>msoa.spdf<span class="sc">$</span>log_no2 <span class="ot">&lt;-</span> <span class="fu">log</span>(msoa.spdf<span class="sc">$</span>no2)</span>
<span id="cb47-481"><a href="#cb47-481" aria-hidden="true" tabindex="-1"></a>msoa.spdf<span class="sc">$</span>log_med_house_price <span class="ot">&lt;-</span> <span class="fu">log</span>(msoa.spdf<span class="sc">$</span>med_house_price)</span>
<span id="cb47-482"><a href="#cb47-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-483"><a href="#cb47-483" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"log_med_house_price"</span>, <span class="st">"log_no2"</span>, <span class="st">"log_POPDEN"</span>, </span>
<span id="cb47-484"><a href="#cb47-484" aria-hidden="true" tabindex="-1"></a>          <span class="st">"per_mixed"</span>, <span class="st">"per_asian"</span>, <span class="st">"per_black"</span>, <span class="st">"per_other"</span>,</span>
<span id="cb47-485"><a href="#cb47-485" aria-hidden="true" tabindex="-1"></a>          <span class="st">"per_owner"</span>, <span class="st">"per_social"</span>, <span class="st">"pubs_count"</span>)</span>
<span id="cb47-486"><a href="#cb47-486" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(v <span class="cf">in</span> vars){</span>
<span id="cb47-487"><a href="#cb47-487" aria-hidden="true" tabindex="-1"></a>  msoa.spdf[, <span class="fu">paste0</span>(<span class="st">"w."</span>, v)] <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(queens.lw,</span>
<span id="cb47-488"><a href="#cb47-488" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">var =</span> <span class="fu">st_drop_geometry</span>(msoa.spdf)[, v])</span>
<span id="cb47-489"><a href="#cb47-489" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-490"><a href="#cb47-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-491"><a href="#cb47-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively:</span></span>
<span id="cb47-492"><a href="#cb47-492" aria-hidden="true" tabindex="-1"></a>w_vars <span class="ot">&lt;-</span> <span class="fu">create_WX</span>(<span class="fu">st_drop_geometry</span>(msoa.spdf[, vars]),</span>
<span id="cb47-493"><a href="#cb47-493" aria-hidden="true" tabindex="-1"></a>                    <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-494"><a href="#cb47-494" aria-hidden="true" tabindex="-1"></a>                    <span class="at">prefix =</span> <span class="st">"w"</span>)</span>
<span id="cb47-495"><a href="#cb47-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-496"><a href="#cb47-496" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(w_vars)</span>
<span id="cb47-497"><a href="#cb47-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-498"><a href="#cb47-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-499"><a href="#cb47-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-500"><a href="#cb47-500" aria-hidden="true" tabindex="-1"></a>And subsequently we use those new variables in a linear model.</span>
<span id="cb47-501"><a href="#cb47-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-504"><a href="#cb47-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-505"><a href="#cb47-505" aria-hidden="true" tabindex="-1"></a>mod_1.lm <span class="ot">&lt;-</span> <span class="fu">lm</span> (<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-506"><a href="#cb47-506" aria-hidden="true" tabindex="-1"></a>                  per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other <span class="sc">+</span></span>
<span id="cb47-507"><a href="#cb47-507" aria-hidden="true" tabindex="-1"></a>                  w.log_no2 <span class="sc">+</span> w.log_POPDEN <span class="sc">+</span></span>
<span id="cb47-508"><a href="#cb47-508" aria-hidden="true" tabindex="-1"></a>                  w.per_mixed <span class="sc">+</span> w.per_asian <span class="sc">+</span> w.per_black <span class="sc">+</span> w.per_other,</span>
<span id="cb47-509"><a href="#cb47-509" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> msoa.spdf)</span>
<span id="cb47-510"><a href="#cb47-510" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.lm)</span>
<span id="cb47-511"><a href="#cb47-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-512"><a href="#cb47-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-513"><a href="#cb47-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-514"><a href="#cb47-514" aria-hidden="true" tabindex="-1"></a>Looks pretty similar to <span class="in">`lmSLX()`</span> results, and it should! A big advantage of the SLX specification is that we can use the lagged variables in basically all methods which take variables as inputs, such as non-linear models, matching algorithms, and machine learning tools.</span>
<span id="cb47-515"><a href="#cb47-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-516"><a href="#cb47-516" aria-hidden="true" tabindex="-1"></a>Moreover, using the lagged variables gives a high degree of freedom. For instance, we could (not saying that it necessarily makes sense):</span>
<span id="cb47-517"><a href="#cb47-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-518"><a href="#cb47-518" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Use different weights matrices for different variables</span>
<span id="cb47-519"><a href="#cb47-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-520"><a href="#cb47-520" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Include higher order neighbours using <span class="in">`nblag()`</span> (with an increasing number of orders we go towards a more global model, but we estimate a coefficient for each spillover, instead of estimating just one)</span>
<span id="cb47-521"><a href="#cb47-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-522"><a href="#cb47-522" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Use machine learning techniques to determine the best fitting weights specification.</span>
<span id="cb47-523"><a href="#cb47-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-524"><a href="#cb47-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-525"><a href="#cb47-525" aria-hidden="true" tabindex="-1"></a><span class="fu">### SDEM</span></span>
<span id="cb47-526"><a href="#cb47-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-527"><a href="#cb47-527" aria-hidden="true" tabindex="-1"></a>SDEM models can be estimated using <span class="in">`errorsarlm()`</span> with the additional option <span class="in">`Durbin = TRUE`</span>.</span>
<span id="cb47-528"><a href="#cb47-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-531"><a href="#cb47-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-532"><a href="#cb47-532" aria-hidden="true" tabindex="-1"></a>mod_1.sdem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span></span>
<span id="cb47-533"><a href="#cb47-533" aria-hidden="true" tabindex="-1"></a>                          per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-534"><a href="#cb47-534" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-535"><a href="#cb47-535" aria-hidden="true" tabindex="-1"></a>                        <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-536"><a href="#cb47-536" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Durbin =</span> <span class="cn">TRUE</span>) <span class="co"># we could here extend to SDEM</span></span>
<span id="cb47-537"><a href="#cb47-537" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sdem)</span>
<span id="cb47-538"><a href="#cb47-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-539"><a href="#cb47-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-540"><a href="#cb47-540" aria-hidden="true" tabindex="-1"></a>And this SDEM can be interpreted like a combination of SEM and SLX. </span>
<span id="cb47-541"><a href="#cb47-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-542"><a href="#cb47-542" aria-hidden="true" tabindex="-1"></a>First, we still see highly significant auto-correlation in the error term. However, it's lower in magnitude now that we also include the $\bm W X$ terms.</span>
<span id="cb47-543"><a href="#cb47-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-544"><a href="#cb47-544" aria-hidden="true" tabindex="-1"></a>Second, the coefficients tell a smimilar story as in the SLX (use the same interpretation), but some coefficient magnitudes have become smaller.</span>
<span id="cb47-545"><a href="#cb47-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-546"><a href="#cb47-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### SDM</span></span>
<span id="cb47-547"><a href="#cb47-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-548"><a href="#cb47-548" aria-hidden="true" tabindex="-1"></a>SDM models can be estimated using <span class="in">`lagsarlm()`</span> with the additional option <span class="in">`Durbin = TRUE`</span>.</span>
<span id="cb47-549"><a href="#cb47-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-552"><a href="#cb47-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-553"><a href="#cb47-553" aria-hidden="true" tabindex="-1"></a>mod_1.sdm <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-554"><a href="#cb47-554" aria-hidden="true" tabindex="-1"></a>                        per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-555"><a href="#cb47-555" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-556"><a href="#cb47-556" aria-hidden="true" tabindex="-1"></a>                      <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-557"><a href="#cb47-557" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Durbin =</span> <span class="cn">TRUE</span>) <span class="co"># we could here extend to SDM</span></span>
<span id="cb47-558"><a href="#cb47-558" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sdm)</span>
<span id="cb47-559"><a href="#cb47-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-560"><a href="#cb47-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-561"><a href="#cb47-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-562"><a href="#cb47-562" aria-hidden="true" tabindex="-1"></a>And this SDM can be interpreted like a combination of SAR and SLX. </span>
<span id="cb47-563"><a href="#cb47-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-564"><a href="#cb47-564" aria-hidden="true" tabindex="-1"></a>First, there's still substantial auto-correlation in $\bm y$, and this has become even stronger as compared to SAR.</span>
<span id="cb47-565"><a href="#cb47-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-566"><a href="#cb47-566" aria-hidden="true" tabindex="-1"></a>Second, we can interpret the direction of the effect, but we *cannot interpret the coefficient as marginal effects*.</span>
<span id="cb47-567"><a href="#cb47-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-568"><a href="#cb47-568" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Examples --&gt;</span></span>
<span id="cb47-569"><a href="#cb47-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-570"><a href="#cb47-570" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- __@Boillat.2022__ --&gt;</span></span>
<span id="cb47-571"><a href="#cb47-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-572"><a href="#cb47-572" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _The paper investigates the effects of protected areas and various land tenure regimes on deforestation and possible spillover effects in Bolivia, a global tropical deforestation hotspot._ --&gt;</span></span>
<span id="cb47-573"><a href="#cb47-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-574"><a href="#cb47-574" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ![](fig/Boillat.png) --&gt;</span></span>
<span id="cb47-575"><a href="#cb47-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-576"><a href="#cb47-576" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _Protected areas – which in Bolivia are all based on co-management schemes - also protect forests in adjacent areas, showing an indirect protective spillover effect. Indigenous lands however only have direct forest protection effects._ --&gt;</span></span>
<span id="cb47-577"><a href="#cb47-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-578"><a href="#cb47-578" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- __@Fischer.2009__ --&gt;</span></span>
<span id="cb47-579"><a href="#cb47-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-580"><a href="#cb47-580" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _The focus of this paper is on the role of human capital in explaining labor productivity variation among 198 European regions within a regression framework._ --&gt;</span></span>
<span id="cb47-581"><a href="#cb47-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-582"><a href="#cb47-582" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ![](fig/Fischer.png) --&gt;</span></span>
<span id="cb47-583"><a href="#cb47-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-584"><a href="#cb47-584" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _A ceteris paribus increase in the level of human capital is found to have a significant and positive direct impact. But this positive direct impact is offset by a significant and negative indirect (spillover) impact leading to a total impact that is not significantly different from zero._ --&gt;</span></span>
<span id="cb47-585"><a href="#cb47-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-586"><a href="#cb47-586" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _The intuition here arises from the notion that it is relative regional advantages in human capital that matter most for labor productivity, so changing human capital across all regions should have little or no total impact on (average) labor productivity levels._ --&gt;</span></span>
<span id="cb47-587"><a href="#cb47-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-588"><a href="#cb47-588" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- __@Ruttenauer.2018a__ --&gt;</span></span>
<span id="cb47-589"><a href="#cb47-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-590"><a href="#cb47-590" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _This study investigates the presence of environmental inequality in Germany - the connection between the presence of foreign-minority population and objectively measured industrial pollution._ --&gt;</span></span>
<span id="cb47-591"><a href="#cb47-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-592"><a href="#cb47-592" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ![](fig/census.png) --&gt;</span></span>
<span id="cb47-593"><a href="#cb47-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-594"><a href="#cb47-594" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- _Results reveal that the share of minorities within a census cell indeed positively correlates with the exposure to industrial pollution. Furthermore, spatial spillover effects are highly relevant: the characteristics of the neighbouring spatial units matter in predicting the amount of pollution. Especially within urban areas, clusters of high minority neighbourhoods are affected by high levels of environmental pollution._ --&gt;</span></span>
<span id="cb47-595"><a href="#cb47-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-596"><a href="#cb47-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-597"><a href="#cb47-597" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimation</span></span>
<span id="cb47-598"><a href="#cb47-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-599"><a href="#cb47-599" aria-hidden="true" tabindex="-1"></a>Note that most of the spatial model specifications can not be estimated by Least Squares (LS), as using (constrained) LS estimators for models containing a spatially lagged dependent variable or disturbance leads to inconsistent results <span class="co">[</span><span class="ot">@Anselin.1998; @Franzese.2007</span><span class="co">]</span>. However, an extensive amount of econometric literature discusses different estimation methods based on (quasi-) maximum likelihood <span class="co">[</span><span class="ot">@Anselin.1988; @Lee.2004; @Ord.1975</span><span class="co">]</span> or instrumental variable approaches using generalized methods of moments <span class="co">[</span><span class="ot">@Drukker.2013; @Kelejian.1998; @Kelejian.2010</span><span class="co">]</span>, in which the endogenous lagged variables can be instrumented by $q$ higher order lags of the exogenous regressors $({\bm X}, {\bm W \bm X}, {\bm W^2 \bm X},..., {\bm W^q  \bm X})$ <span class="co">[</span><span class="ot">@Kelejian.1998</span><span class="co">]</span>.</span>
<span id="cb47-600"><a href="#cb47-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-601"><a href="#cb47-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulataneity bias</span></span>
<span id="cb47-602"><a href="#cb47-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-603"><a href="#cb47-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-604"><a href="#cb47-604" aria-hidden="true" tabindex="-1"></a>Remember what is happening when we estimate a spatial auto-regressive model.</span>
<span id="cb47-605"><a href="#cb47-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-606"><a href="#cb47-606" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/Graph.jpg)</span></span>
<span id="cb47-607"><a href="#cb47-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-608"><a href="#cb47-608" aria-hidden="true" tabindex="-1"></a>Note the circular process here: My $X$ influences my $Y$, which then influences your $Y$, which then influences my $Y$ again. We write this as</span>
<span id="cb47-609"><a href="#cb47-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-610"><a href="#cb47-610" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-611"><a href="#cb47-611" aria-hidden="true" tabindex="-1"></a>    \begin{equation} </span>
<span id="cb47-612"><a href="#cb47-612" aria-hidden="true" tabindex="-1"></a>        {\bm y}=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+ {\bm \varepsilon}.</span>
<span id="cb47-613"><a href="#cb47-613" aria-hidden="true" tabindex="-1"></a>        \end{equation}  </span>
<span id="cb47-614"><a href="#cb47-614" aria-hidden="true" tabindex="-1"></a>$$  </span>
<span id="cb47-615"><a href="#cb47-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-616"><a href="#cb47-616" aria-hidden="true" tabindex="-1"></a>If we ignore ${\bm X}{\bm \beta}$ and write the pure auto-regressive term in its reduce form, we get: </span>
<span id="cb47-617"><a href="#cb47-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-618"><a href="#cb47-618" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-619"><a href="#cb47-619" aria-hidden="true" tabindex="-1"></a>\bm y =\left(\bm I_n - \rho\bm W\right)^{-1}\varepsilon,</span>
<span id="cb47-620"><a href="#cb47-620" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-621"><a href="#cb47-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-622"><a href="#cb47-622" aria-hidden="true" tabindex="-1"></a>and the spatial lag term is</span>
<span id="cb47-623"><a href="#cb47-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-624"><a href="#cb47-624" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-625"><a href="#cb47-625" aria-hidden="true" tabindex="-1"></a>\bm W \bm y =\bm W\left(\bm I_n - \rho\bm W\right)^{-1}\varepsilon.</span>
<span id="cb47-626"><a href="#cb47-626" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-627"><a href="#cb47-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-628"><a href="#cb47-628" aria-hidden="true" tabindex="-1"></a>The OLS estimator for the spatial lag term then is</span>
<span id="cb47-629"><a href="#cb47-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-630"><a href="#cb47-630" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-631"><a href="#cb47-631" aria-hidden="true" tabindex="-1"></a>\hat{\rho}_{OLS} = \left[\underbrace{\left(\bm W\bm y \right)^\top}_{(1\times n)}\underbrace{\left(\bm W\bm y \right)}_{(n\times 1)}\right]^{-1}\underbrace{\left(\bm W\bm y \right)^\top}_{(1\times n)}\underbrace{\bm y}_{(n\times 1)}.</span>
<span id="cb47-632"><a href="#cb47-632" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-633"><a href="#cb47-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-634"><a href="#cb47-634" aria-hidden="true" tabindex="-1"></a>It can then be shown that the OLS estimators equals</span>
<span id="cb47-635"><a href="#cb47-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-636"><a href="#cb47-636" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-637"><a href="#cb47-637" aria-hidden="true" tabindex="-1"></a>          \hat{\rho}_{OLS} = \rho + \left<span class="co">[</span><span class="ot">\left(\bm W\bm y \right)^\top\left(\bm W\bm y \right)\right</span><span class="co">]</span>^{-1}\left(\bm W\bm y \right)^\top\varepsilon <span class="sc">\\</span></span>
<span id="cb47-638"><a href="#cb47-638" aria-hidden="true" tabindex="-1"></a>                                = \rho + \left(\sum_{i = 1}^n \bm y_{Li}^2\right)^{-1}\left(\sum_{i = 1}^{n}\bm y_{Li}\epsilon_i\right),</span>
<span id="cb47-639"><a href="#cb47-639" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-640"><a href="#cb47-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-641"><a href="#cb47-641" aria-hidden="true" tabindex="-1"></a>with $\bm y_{Li}$ defined as the $i$th element of the spatial lag operator $\bm W\bm y = \bm y_L$. It can further be shown that the second part of the equation $\neq 0$, which demonstrates that OLS gives a biased estimate of $\rho$ <span class="co">[</span><span class="ot">@Franzese.2007; @Sarrias.2023</span><span class="co">]</span>.</span>
<span id="cb47-642"><a href="#cb47-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-643"><a href="#cb47-643" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb47-644"><a href="#cb47-644" aria-hidden="true" tabindex="-1"></a>Do not estimate spatial lags of the dependent variable in OLS. It will suffer from simultaneity bias.</span>
<span id="cb47-645"><a href="#cb47-645" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb47-646"><a href="#cb47-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-647"><a href="#cb47-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-648"><a href="#cb47-648" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instrumental variable</span></span>
<span id="cb47-649"><a href="#cb47-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-650"><a href="#cb47-650" aria-hidden="true" tabindex="-1"></a>A potential way of estimating spatial lag /SAR models is 2SLS <span class="co">[</span><span class="ot">@Kelejian.1998</span><span class="co">]</span>.</span>
<span id="cb47-651"><a href="#cb47-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-652"><a href="#cb47-652" aria-hidden="true" tabindex="-1"></a>We start with our standard model</span>
<span id="cb47-653"><a href="#cb47-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-654"><a href="#cb47-654" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-655"><a href="#cb47-655" aria-hidden="true" tabindex="-1"></a>        {\bm y}=\alpha{\bm \iota}+\rho{\bm W}{\bm y}+{\bm X}{\bm \beta}+ {\bm \varepsilon}. </span>
<span id="cb47-656"><a href="#cb47-656" aria-hidden="true" tabindex="-1"></a>$$  </span>
<span id="cb47-657"><a href="#cb47-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-658"><a href="#cb47-658" aria-hidden="true" tabindex="-1"></a>As we have seen above, there is a problem of simultaneity: the "covariate" ${\bm W}{\bm y}$ is endogenous. One way of dealing with this endogeneity problem is the Instrumental Variable approach.</span>
<span id="cb47-659"><a href="#cb47-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-660"><a href="#cb47-660" aria-hidden="true" tabindex="-1"></a>So, the question is what are good instruments $\bm  H$ for ${\bm W}{\bm y}$? As we have specified the mode, we are sure that ${\bm X}$ determines ${\bm y}$. Thus, it must be true that ${\bm W}{\bm X}$ and ${\bm W}^2{\bm X},\ldots, {\bm W}^l{\bm X}$ determines ${\bm W}{\bm y}$.</span>
<span id="cb47-661"><a href="#cb47-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-662"><a href="#cb47-662" aria-hidden="true" tabindex="-1"></a>Note that ${\bm W}^l$ denotes higher orders of ${\bm W}$. So ${\bm W}^2$ are the second order neighbours (neighbours of neighbours), and ${\bm W}^3$ are the third order neighbours (the neighbours of my neighbour's neighbours), and so on...</span>
<span id="cb47-663"><a href="#cb47-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-664"><a href="#cb47-664" aria-hidden="true" tabindex="-1"></a>We will discuss this in more detail later, but note for now that the reduced form of the SAR always contains a series of higher order neighbours.</span>
<span id="cb47-665"><a href="#cb47-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-666"><a href="#cb47-666" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-667"><a href="#cb47-667" aria-hidden="true" tabindex="-1"></a>({\bm I_N}-\rho {\bm W})^{-1}\beta_k </span>
<span id="cb47-668"><a href="#cb47-668" aria-hidden="true" tabindex="-1"></a>=({\bm I_N} + \rho{\bm W} + \rho^2{\bm W}^2 + \rho^3{\bm W}^3 + ...)\beta_k </span>
<span id="cb47-669"><a href="#cb47-669" aria-hidden="true" tabindex="-1"></a>= ({\bm I_N} + \sum_{h=1}^\infty \rho^h{\bm W}^h)\beta_k .</span>
<span id="cb47-670"><a href="#cb47-670" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-671"><a href="#cb47-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-672"><a href="#cb47-672" aria-hidden="true" tabindex="-1"></a>Thus, @Kelejian.1998 suggested to use a set of lagged covariates as instruments for $\bm W \bm Y$:</span>
<span id="cb47-673"><a href="#cb47-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-674"><a href="#cb47-674" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-675"><a href="#cb47-675" aria-hidden="true" tabindex="-1"></a>\bm H = \bm X, \bm W\bm X, \bm W^2\bm X, ... , \bm W^l\bm X,</span>
<span id="cb47-676"><a href="#cb47-676" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-677"><a href="#cb47-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-678"><a href="#cb47-678" aria-hidden="true" tabindex="-1"></a>where $l$ is a pre-defined number for the higher order neighbours included. In practice, $l$ is usually restricted to  $l=2$.</span>
<span id="cb47-679"><a href="#cb47-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-680"><a href="#cb47-680" aria-hidden="true" tabindex="-1"></a>This has further been developed by, for instance, using a (truncated) power series as instruments <span class="co">[</span><span class="ot">@Kelejian.2004</span><span class="co">]</span>:</span>
<span id="cb47-681"><a href="#cb47-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-682"><a href="#cb47-682" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-683"><a href="#cb47-683" aria-hidden="true" tabindex="-1"></a>\bm H =\left<span class="co">[</span><span class="ot">\bm X, \bm W\left(\sum_{l = 1}^{\infty}\rho^{l}\bm W^l\right)\bm X \bm\beta\right</span><span class="co">]</span>.</span>
<span id="cb47-684"><a href="#cb47-684" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb47-685"><a href="#cb47-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-686"><a href="#cb47-686" aria-hidden="true" tabindex="-1"></a>We can estimate this using the pacakge <span class="in">`spatialreg`</span> with the function <span class="in">`stsls()`</span>, </span>
<span id="cb47-687"><a href="#cb47-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-688"><a href="#cb47-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb47-689"><a href="#cb47-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Contiguity (Queens) neighbours weights</span></span>
<span id="cb47-690"><a href="#cb47-690" aria-hidden="true" tabindex="-1"></a>queens.nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(msoa.spdf, </span>
<span id="cb47-691"><a href="#cb47-691" aria-hidden="true" tabindex="-1"></a>                     <span class="at">queen =</span> <span class="cn">TRUE</span>, </span>
<span id="cb47-692"><a href="#cb47-692" aria-hidden="true" tabindex="-1"></a>                     <span class="at">snap =</span> <span class="dv">1</span>) <span class="co"># we consider points in 1m distance as 'touching'</span></span>
<span id="cb47-693"><a href="#cb47-693" aria-hidden="true" tabindex="-1"></a>queens.lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(queens.nb,</span>
<span id="cb47-694"><a href="#cb47-694" aria-hidden="true" tabindex="-1"></a>                      <span class="at">style =</span> <span class="st">"W"</span>)</span>
<span id="cb47-695"><a href="#cb47-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-696"><a href="#cb47-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-699"><a href="#cb47-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-700"><a href="#cb47-700" aria-hidden="true" tabindex="-1"></a>mod_1.sls <span class="ot">&lt;-</span> <span class="fu">stsls</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-701"><a href="#cb47-701" aria-hidden="true" tabindex="-1"></a>                     per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-702"><a href="#cb47-702" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-703"><a href="#cb47-703" aria-hidden="true" tabindex="-1"></a>                   <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-704"><a href="#cb47-704" aria-hidden="true" tabindex="-1"></a>                   <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="co">#  heteroskedasticity robust SEs</span></span>
<span id="cb47-705"><a href="#cb47-705" aria-hidden="true" tabindex="-1"></a>                   <span class="at">W2X =</span> <span class="cn">TRUE</span>) <span class="co"># Second order neighbours are included as instruments (else only first)</span></span>
<span id="cb47-706"><a href="#cb47-706" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sls)</span>
<span id="cb47-707"><a href="#cb47-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-708"><a href="#cb47-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-709"><a href="#cb47-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-710"><a href="#cb47-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-711"><a href="#cb47-711" aria-hidden="true" tabindex="-1"></a><span class="fu">## Maximum Likelihood</span></span>
<span id="cb47-712"><a href="#cb47-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-713"><a href="#cb47-713" aria-hidden="true" tabindex="-1"></a>Maximum Likelihood estimation of spatial models is the most common way of estimation. The procedure to estimate SAR models via ML is based on @Ord.1975 and @Anselin.1988. If you are interested in more details, please look at the more extensive <span class="co">[</span><span class="ot">3-day workshop</span><span class="co">](https://ruettenauer.github.io/Geodata_Spatial_Regression/06_regression-estimation.html)</span> or have a look into @Sarrias.2023.</span>
<span id="cb47-714"><a href="#cb47-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-715"><a href="#cb47-715" aria-hidden="true" tabindex="-1"></a>The package <span class="in">`spatialreg`</span> <span class="co">[</span><span class="ot">@Bivand.2021, @Pebesma.2023</span><span class="co">]</span> provides a series of functions to calculate the ML estimator for all spatial models we have considered.</span>
<span id="cb47-716"><a href="#cb47-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-717"><a href="#cb47-717" aria-hidden="true" tabindex="-1"></a>Table from @Pebesma.2023:</span>
<span id="cb47-718"><a href="#cb47-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-719"><a href="#cb47-719" aria-hidden="true" tabindex="-1"></a>| model | model name                      | maximum likelihood estimation function |</span>
<span id="cb47-720"><a href="#cb47-720" aria-hidden="true" tabindex="-1"></a>|-------|---------------------------------|----------------------------------------|</span>
<span id="cb47-721"><a href="#cb47-721" aria-hidden="true" tabindex="-1"></a>| SEM   | spatial error                   | <span class="in">`errorsarlm(..., Durbin=FALSE)`</span>   |</span>
<span id="cb47-722"><a href="#cb47-722" aria-hidden="true" tabindex="-1"></a>| SEM   | spatial error                   | <span class="in">`spautolm(..., family="SAR")`</span>     |</span>
<span id="cb47-723"><a href="#cb47-723" aria-hidden="true" tabindex="-1"></a>| SDEM  | spatial Durbin error            | <span class="in">`errorsarlm(..., Durbin=TRUE)`</span>    |</span>
<span id="cb47-724"><a href="#cb47-724" aria-hidden="true" tabindex="-1"></a>| SLM   | spatial lag                     | <span class="in">`lagsarlm(..., Durbin=FALSE)`</span>     |</span>
<span id="cb47-725"><a href="#cb47-725" aria-hidden="true" tabindex="-1"></a>| SDM   | spatial Durbin                  | <span class="in">`lagsarlm(..., Durbin=TRUE)`</span>      |</span>
<span id="cb47-726"><a href="#cb47-726" aria-hidden="true" tabindex="-1"></a>| SAC   | spatial autoregressive combined | <span class="in">`sacsarlm(..., Durbin=FALSE)`</span>     |</span>
<span id="cb47-727"><a href="#cb47-727" aria-hidden="true" tabindex="-1"></a>| GNM   | general nested                  | <span class="in">`sacsarlm(..., Durbin=TRUE)`</span>      |</span>
<span id="cb47-728"><a href="#cb47-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-729"><a href="#cb47-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-730"><a href="#cb47-730" aria-hidden="true" tabindex="-1"></a>**ML SAR**</span>
<span id="cb47-731"><a href="#cb47-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-734"><a href="#cb47-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-735"><a href="#cb47-735" aria-hidden="true" tabindex="-1"></a>mod_1.sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span> </span>
<span id="cb47-736"><a href="#cb47-736" aria-hidden="true" tabindex="-1"></a>                        per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-737"><a href="#cb47-737" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-738"><a href="#cb47-738" aria-hidden="true" tabindex="-1"></a>                      <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-739"><a href="#cb47-739" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Durbin =</span> <span class="cn">FALSE</span>) <span class="co"># we could here extend to SDM</span></span>
<span id="cb47-740"><a href="#cb47-740" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sar)</span>
<span id="cb47-741"><a href="#cb47-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-742"><a href="#cb47-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-743"><a href="#cb47-743" aria-hidden="true" tabindex="-1"></a>**ML SEM**</span>
<span id="cb47-744"><a href="#cb47-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-747"><a href="#cb47-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-748"><a href="#cb47-748" aria-hidden="true" tabindex="-1"></a>mod_1.sem <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(<span class="fu">log</span>(med_house_price) <span class="sc">~</span> <span class="fu">log</span>(no2) <span class="sc">+</span> <span class="fu">log</span>(POPDEN) <span class="sc">+</span></span>
<span id="cb47-749"><a href="#cb47-749" aria-hidden="true" tabindex="-1"></a>                          per_mixed <span class="sc">+</span> per_asian <span class="sc">+</span> per_black <span class="sc">+</span> per_other,  </span>
<span id="cb47-750"><a href="#cb47-750" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> msoa.spdf, </span>
<span id="cb47-751"><a href="#cb47-751" aria-hidden="true" tabindex="-1"></a>                        <span class="at">listw =</span> queens.lw,</span>
<span id="cb47-752"><a href="#cb47-752" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Durbin =</span> <span class="cn">FALSE</span>) <span class="co"># we could here extend to SDEM</span></span>
<span id="cb47-753"><a href="#cb47-753" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_1.sem)</span>
<span id="cb47-754"><a href="#cb47-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb47-755"><a href="#cb47-755" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>